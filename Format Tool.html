<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>7fx8's Dox Formatter [PREMIUM]</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #7e57c2;
      --primary-rgb: 126, 87, 194; /* RGB values of primary-color */
      --accent-color: #5e35b1;
      --text-color: #333;
      --light-text: #666;
      --bg-color: #f8f9fc;
      --panel-bg: #ffffff;
      --border-color: #e6e8f0;
      --shadow-color: rgba(126, 87, 194, 0.1);
      --success-color: #66bb6a;
      --warning-color: #ffb74d;
      --error-color: #e57373;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px;
    }
    
    .app-header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeIn 1s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    h1 {
      color: var(--primary-color);
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px var(--shadow-color);
      letter-spacing: 1px;
    }
    
    .subtitle {
      color: var(--light-text);
      font-size: 1.1rem;
      margin-bottom: 20px;
      font-weight: 300;
    }
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--panel-bg);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.5);
      z-index: 1000; /* Higher z-index to ensure it's clickable */
      border: 2px solid var(--primary-color);
    }
    
    .theme-icon {
      color: var(--primary-color);
      font-size: 1.5rem; /* Bigger icon */
    }
    
    body.dark-mode .theme-icon {
      color: white; /* White icon in dark mode */
    }
    
    /* Make sure dark mode really applies with !important flags */
    body.dark-mode {
      background-color: #000000 !important; 
    }
    
    /* Style all buttons red in dark mode */
    body.dark-mode .btn,
    body.dark-mode button,
    body.dark-mode .btn-primary,
    body.dark-mode .btn-secondary,
    body.dark-mode .btn-success,
    body.dark-mode .btn-info {
      background-color: #ff3030 !important;
      border-color: #ff5050 !important;
      color: white !important;
    }
    
    /* Additional overrides for specific elements */
    body.dark-mode .container {
      background-color: #000000 !important;
    }
    
    body.dark-mode .section-content {
      background-color: #000000 !important;
    }
    
    /* Make sure section content and panels have black background */
    body.dark-mode .panel,
    body.dark-mode .section {
      background-color: #000000 !important;
    }
    
    body.dark-mode .section-header {
      background-color: #0a0a0a !important;
    }
    
    /* Removed theme menu styles */
    
    .main-content {
      display: flex;
      gap: 30px;
      flex-direction: column;
    }
    
    /* Keep layout column-first so the form (info sections) remains prominent and
       the generated output is shown below. On wide screens increase form-area
       padding to make the left menu feel larger. */
    @media (min-width: 992px) {
      .main-content {
        flex-direction: column;
      }

      .form-area {
        /* make form area visually larger on wide screens */
        max-width: 1100px;
        margin: 0 auto;
        padding: 30px;
      }

      .output-area {
        position: static;
        align-self: stretch;
      }
    }
    
    .panel {
      background: var(--panel-bg);
      border-radius: 15px;
      box-shadow: 0 5px 15px var(--shadow-color);
      padding: 25px;
      margin-bottom: 30px;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      overflow: hidden;
    }
    
    .panel:hover {
      box-shadow: 0 10px 25px var(--shadow-color);
      transform: translateY(-2px);
    }
    
    .section-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 15px;
    }
    
    .tab-btn {
      padding: 10px 15px;
      border: none;
      background-color: transparent;
      color: var(--light-text);
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .tab-btn::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 3px;
      background-color: var(--primary-color);
      transition: all 0.3s ease;
      transform: translateX(-50%);
      border-radius: 3px;
    }
    
    .tab-btn:hover {
      color: var(--primary-color);
    }
    
    .tab-btn:hover::before {
      width: 80%;
    }
    
    .tab-btn.active {
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .tab-btn.active::before {
      width: 80%;
    }
    
    /* Removed tab-indicator styles as numbers are no longer used */
    
    .section {
      margin-bottom: 25px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      cursor: pointer;
      background-color: rgba(248, 249, 252, 0.6);
      transition: all 0.2s ease;
      border-bottom: 1px solid transparent;
      position: relative;
      z-index: 10;
    }
    
    .section-header:hover {
      background-color: rgba(248, 249, 252, 0.9);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .section-header {
      background-color: rgba(30, 32, 36, 0.6);
    }
    
    body.dark-mode .section-header:hover {
      background-color: rgba(30, 32, 36, 0.9);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .section.active .section-header {
  border-bottom: 1px solid var(--border-color);
  background-color: rgba(248, 249, 252, 1);
  box-shadow: 0 4px 14px rgba(0,0,0,0.03);
    }
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: var(--primary-color);
      font-size: 1.1rem;
      margin: 0;
    }
    
    .section-icon {
      color: var(--primary-color);
      font-size: 1rem;
    }
    
    .toggle-icon {
      color: var(--light-text);
      transition: all 0.3s ease;
      font-size: 1rem;
      padding: 4px 6px;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .section.active .toggle-icon {
      transform: rotate(180deg);
      color: var(--primary-color);
      background-color: rgba(var(--primary-rgb), 0.1);
    }
    
    body.dark-mode .toggle-icon {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-mode .section.active .toggle-icon {
      background-color: rgba(var(--primary-rgb), 0.2);
    }
    
    .section-content {
      padding: 0;
      max-height: 0;
      height: 0;
      display: none;
      overflow: hidden;
      transition: none;
      opacity: 0;
    }

    /* When active, allow natural height and comfortable padding */
    .section.active .section-content {
      display: block !important;
      padding: 18px 20px;
      max-height: none;
      height: auto;
      opacity: 1;
      overflow: visible;
    }

    /* small gap between stacked sections */
    .section + .section {
      margin-top: 12px;
    }
    
    .field-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    .field-toggle {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      cursor: pointer;
    }
    
    .checkbox-wrapper {
      position: relative;
      display: inline-block;
      width: 18px;
      height: 18px;
      margin-right: 8px;
    }
    
    .checkbox-wrapper input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
    }
    
    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      width: 18px;
      height: 18px;
      background-color: var(--panel-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    
    .checkbox-wrapper input:checked + .checkmark {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
    }
    
    .checkbox-wrapper input:checked + .checkmark:after {
      display: block;
      left: 6px;
      top: 2px;
      width: 4px;
      height: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
    
    .field-toggle label {
      font-weight: 500;
      font-size: 0.95rem;
      color: var(--text-color);
      transition: all 0.2s ease;
    }
    
    .field-toggle:hover label {
      color: var(--primary-color);
    }
    
    .warning-tag {
      background-color: rgba(255, 183, 77, 0.2);
      color: #e65100;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-left: 5px;
      font-weight: 600;
    }
    
    .input-field {
      width: 100%;
      padding: 12px 15px;
      background-color: var(--panel-bg);
      border: 1px solid var(--border-color);
      color: var(--text-color);
      border-radius: 8px;
      margin-top: 5px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.1);
    }
    
    .input-field:disabled {
      background-color: #f5f5f5;
      cursor: not-allowed;
    }
    
    textarea.input-field {
      height: 100px;
      resize: vertical;
    }
    
    .family-member, .education-level {
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 8px;
      background-color: rgba(126, 87, 194, 0.05);
      border-left: 3px solid var(--primary-color);
    }
    
    .family-member h4, .education-level h4 {
      margin-top: 0;
      color: var(--primary-color);
      font-weight: 600;
      font-size: 1rem;
    }
    
    .controls {
      display: flex;
      gap: 12px;
      margin: 25px 0;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow-color);
    }
    
    .btn-outline {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }
    
    .btn-outline:hover {
      background-color: rgba(126, 87, 194, 0.05);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background-color: #e0e0e0;
      color: var(--text-color);
    }
    
    .btn-secondary:hover {
      background-color: #d5d5d5;
    }
    
    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .output-box {
      height: 400px;
      padding: 20px;
      font-family: 'Consolas', monospace;
      background-color: #2d2d2d;
      color: #f8f8f8;
      border-radius: 10px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.5;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .output-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }
    
    .output-box:hover .output-controls {
      opacity: 1;
    }
    
    .output-btn {
      background-color: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 4px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      transition: all 0.2s ease;
    }
    
    .output-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .templates-section {
      margin-top: 30px;
    }
    
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .template-card {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .template-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px var(--shadow-color);
      border-color: var(--primary-color);
    }
    
    .active-template {
      border-color: #4CAF50 !important;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5) !important;
    }
    
    .active-template::after {
      content: '✓';
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #4CAF50;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .template-preview {
      height: 120px;
      background-color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--light-text);
      font-size: 2rem;
      border-bottom: 1px solid var(--border-color);
    }
    
    .template-info {
      padding: 15px;
    }

    /* Hide field groups or toggle rows for templates that don't include them */
    .template-hidden {
      display: none !important;
    }
    
    .template-name {
      margin: 0 0 5px 0;
      font-size: 1rem;
      color: var(--text-color);
      font-weight: 600;
    }
    
    .template-description {
      margin: 0;
      font-size: 0.85rem;
      color: var(--light-text);
    }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }
    
    .toast {
      background-color: var(--panel-bg);
      color: var(--text-color);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 300px;
      max-width: 400px;
      animation: slideIn 0.3s ease forwards;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateX(100%);
    }
    
    @keyframes slideIn {
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes slideOut {
      to { opacity: 0; transform: translateX(100%); }
    }
    
    .toast.success { border-left: 4px solid var(--success-color); }
    .toast.warning { border-left: 4px solid var(--warning-color); }
    .toast.error { border-left: 4px solid var(--error-color); }
    
    .toast-icon {
      font-size: 1.2rem;
    }
    
    .toast.success .toast-icon { color: var(--success-color); }
    .toast.warning .toast-icon { color: var(--warning-color); }
    .toast.error .toast-icon { color: var(--error-color); }
    
    .toast-content {
      flex: 1;
    }
    
    .toast-title {
      font-weight: 600;
      margin-bottom: 3px;
    }
    
    .toast-message {
      font-size: 0.9rem;
      color: var(--light-text);
    }
    
    .toast-close {
      background: none;
      border: none;
      color: var(--light-text);
      cursor: pointer;
      font-size: 1rem;
      padding: 0;
      transition: color 0.2s ease;
    }
    
    .toast-close:hover {
      color: var(--text-color);
    }
    
    .progress-bar {
      width: 100%;
      height: 3px;
      background-color: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .progress {
      height: 100%;
      background-color: var(--primary-color);
      width: 100%;
      animation: progress 5s linear forwards;
    }
    
    @keyframes progress {
      to { width: 0; }
    }
    
    .emoji-picker {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: 100;
      background: var(--panel-bg);
      border-radius: 8px;
      box-shadow: 0 5px 15px var(--shadow-color);
      padding: 10px;
      width: 300px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      display: none;
    }
    
    .emoji-btn {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    
    .emoji-btn:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    
    /* Dark mode styles */
    body.dark-mode {
      --primary-color: #ff3030 !important; /* Changed from purple to red */
      --accent-color: #ff5050 !important; /* Changed from purple to lighter red */
      --text-color: #e0e0e0 !important;
      --light-text: #a0a0a0 !important;
      --bg-color: #000000 !important; /* Pure black background */
      --panel-bg: #0a0a0a !important; /* Nearly black panels */
      --border-color: #333333 !important;
      --shadow-color: rgba(0, 0, 0, 0.3) !important;
      background-color: #000000 !important;
      color: #e0e0e0 !important;
    }
    
    body.dark-mode .output-box {
      background-color: #0a0a0a; /* Darker in dark mode */
      color: #f0f0f0;
    }
    
    body.dark-mode .section-content {
      background-color: #000000 !important; /* Pure black background */
      border-color: #333 !important;
    }
    
    body.dark-mode .app-header h1 {
      color: #fff;
    }
    
    body.dark-mode .app-header .subtitle {
      color: #ccc;
    }
    
    body.dark-mode input, 
    body.dark-mode textarea {
      background-color: #111;
      color: #ddd;
      border-color: #444;
    }
    
    body.dark-mode input:focus, 
    body.dark-mode textarea:focus {
      border-color: var(--primary-color);
    }
    
    /* Make all buttons red in dark mode */
    body.dark-mode .btn-primary,
    body.dark-mode .btn-secondary,
    body.dark-mode .btn-success,
    body.dark-mode .btn-info {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    body.dark-mode .checkmark {
      background-color: #222;
      border-color: #444;
    }
    
    /* Responsive styles */
    @media screen and (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .main-content {
        flex-direction: column;
      }
      
      .section-tabs {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 10px;
        flex-wrap: nowrap;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      .section-tabs::-webkit-scrollbar {
        display: none;
      }
      
      .tab-btn {
        padding: 8px 12px;
        font-size: 0.9rem;
      }
      
      .panel {
        padding: 15px;
      }
      
      .output-box {
        height: auto;
        min-height: 300px;
        position: relative;
      }
      
      .output-content {
        width: 100%;
        min-height: 300px;
        max-height: 600px;
        overflow: auto;
        white-space: pre-wrap;
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-family: monospace;
        margin: 0;
        word-break: break-word;
        display: block !important; /* Make sure it's visible */
        font-size: 14px;
        line-height: 1.5;
        color: #333;
      }
      
      .dark-mode .output-content {
        background-color: #2d2d2d;
        color: #f0f0f0;
        border-color: #444;
      }
      
      .output-controls {
        position: absolute;
        top: 5px;
        right: 5px;
        z-index: 10;
        display: flex;
        gap: 5px;
      }
      
      .output-btn {
        background-color: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 3px;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .dark-mode .output-btn {
        background-color: rgba(60, 60, 60, 0.8);
        color: white;
      }
      
      .output-btn:hover {
        background-color: rgba(230, 230, 230, 1);
      }
      
      .dark-mode .output-btn:hover {
        background-color: rgba(80, 80, 80, 1);
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">
    <i class="theme-icon fas fa-moon"></i>
  </button>
  
  <script>
    // Direct toggle function
    function toggleTheme() {
      console.log("Toggle theme clicked");
      if (document.body.classList.contains('dark-mode')) {
        // Switch to light
        document.body.classList.remove('dark-mode');
        document.querySelector('.theme-icon').className = 'theme-icon fas fa-moon';
        localStorage.setItem('theme', 'light');
      } else {
        // Switch to dark
        document.body.classList.add('dark-mode');
        document.querySelector('.theme-icon').className = 'theme-icon fas fa-sun';
        localStorage.setItem('theme', 'dark');
      }
    }
    
    // Apply initial theme
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.querySelector('.theme-icon').className = 'theme-icon fas fa-sun';
    }
  </script>
  
  <div class="container">
    <div class="app-header">
      <h1>7fx8's Dox Formatter</h1>
      <p class="subtitle">Create beautifully formatted dox files with ease</p>
    </div>
    
    <div class="main-content">
      <div class="form-area">
        <div class="panel">
          <div class="section-tabs">
            <button class="tab-btn active" data-section="basic">Basic Info</button>
            <button class="tab-btn" data-section="personal">Personal Info</button>
            <button class="tab-btn" data-section="family">Family Info</button>
            <button class="tab-btn" data-section="education">Education</button>
            <button class="tab-btn" data-section="socials">Socials</button>
            <button class="tab-btn" data-section="leaks">Data Leaks</button>
          </div>

          <!-- Basic Information Section -->
          <div id="section-basic" class="section active">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-user"></i> Basic Information</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-picture-toggle" checked><span class="checkmark"></span></label>
                  <label for="basic-picture-toggle">Picture Link</label>
                </div>
                <input type="text" id="basic-picture" class="input-field" placeholder="Enter URL to picture">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-name-toggle"><span class="checkmark"></span></label>
                  <label for="basic-name-toggle">Name</label>
                </div>
                <input type="text" id="basic-name" class="input-field" placeholder="Enter full name">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-pseudonyms-toggle"><span class="checkmark"></span></label>
                  <label for="basic-pseudonyms-toggle">Pseudonyms</label>
                </div>
                <input type="text" id="basic-pseudonyms" class="input-field" placeholder="Enter aliases or nicknames">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-reason-toggle"><span class="checkmark"></span></label>
                  <label for="basic-reason-toggle">Reason</label>
                </div>
                <textarea id="basic-reason" class="input-field" placeholder="Enter reason for this dox"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-age-toggle"><span class="checkmark"></span></label>
                  <label for="basic-age-toggle">Age</label>
                </div>
                <input type="text" id="basic-age" class="input-field" placeholder="Age">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-dob-toggle"><span class="checkmark"></span></label>
                  <label for="basic-dob-toggle">Date of Birth</label>
                </div>
                <input type="text" id="basic-dob" class="input-field" placeholder="YYYY-MM-DD">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-birthplace-toggle"><span class="checkmark"></span></label>
                  <label for="basic-birthplace-toggle">Place of Birth</label>
                </div>
                <input type="text" id="basic-birthplace" class="input-field" placeholder="City, State, Country">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-location-toggle"><span class="checkmark"></span></label>
                  <label for="basic-location-toggle">Current Location</label>
                </div>
                <input type="text" id="basic-location" class="input-field" placeholder="City, State, Country">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-race-toggle"><span class="checkmark"></span></label>
                  <label for="basic-race-toggle">Race / Ethnicity</label>
                </div>
                <input type="text" id="basic-race" class="input-field" placeholder="Race or ethnicity">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-sexual-toggle"><span class="checkmark"></span></label>
                  <label for="basic-sexual-toggle">Sexual Orientation</label>
                </div>
                <input type="text" id="basic-sexual" class="input-field" placeholder="Sexual orientation">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-political-toggle"><span class="checkmark"></span></label>
                  <label for="basic-political-toggle">Political Affiliation</label>
                </div>
                <input type="text" id="basic-political" class="input-field" placeholder="Political affiliation">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-language-toggle"><span class="checkmark"></span></label>
                  <label for="basic-language-toggle">Native Language</label>
                </div>
                <input type="text" id="basic-language" class="input-field" placeholder="English, Spanish, ...">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-religion-toggle"><span class="checkmark"></span></label>
                  <label for="basic-religion-toggle">Religion</label>
                </div>
                <input type="text" id="basic-religion" class="input-field" placeholder="Religion / beliefs">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-additional-info-toggle"><span class="checkmark"></span></label>
                  <label for="basic-additional-info-toggle">Additional Information</label>
                </div>
                <textarea id="basic-additional-info" class="input-field" placeholder="Enter any additional information"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-gender-toggle"><span class="checkmark"></span></label>
                  <label for="basic-gender-toggle">Gender</label>
                </div>
                <input type="text" id="basic-gender" class="input-field" placeholder="Gender">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-weight-toggle"><span class="checkmark"></span></label>
                  <label for="basic-weight-toggle">Weight</label>
                </div>
                <input type="text" id="basic-weight" class="input-field" placeholder="Weight (e.g., 150 lbs, 68 kg)">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="basic-height-toggle"><span class="checkmark"></span></label>
                  <label for="basic-height-toggle">Height</label>
                </div>
                <input type="text" id="basic-height" class="input-field" placeholder="Height (e.g., 5'10\", 178 cm)">
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="notes-toggle"><span class="checkmark"></span></label>
                  <label for="notes-toggle">Notes</label>
                </div>
                <textarea id="notes" class="input-field" placeholder="Notes for template output"></textarea>
              </div>
            </div>
          </div>

          <!-- Personal Information Section -->
          <div id="section-personal" class="section">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-id-card"></i> Personal Information</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-citizenship-toggle"><span class="checkmark"></span></label>
                  <label for="personal-citizenship-toggle">Country of Citizenship</label>
                </div>
                <input type="text" id="personal-citizenship" class="input-field" placeholder="Enter country of citizenship">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-ssn-toggle"><span class="checkmark"></span></label>
                  <label for="personal-ssn-toggle">Social Security Number (SSN) <span class="warning-tag">SENSITIVE</span></label>
                </div>
                <input type="text" id="personal-ssn" class="input-field" placeholder="XXX-XX-XXXX">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-dln-toggle"><span class="checkmark"></span></label>
                  <label for="personal-dln-toggle">Driver License Number (DLN)</label>
                </div>
                <input type="text" id="personal-dln" class="input-field" placeholder="License number">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-isp-toggle"><span class="checkmark"></span></label>
                  <label for="personal-isp-toggle">Internet Service Provider (ISP)</label>
                </div>
                <input type="text" id="personal-isp" class="input-field" placeholder="ISP name">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-area-toggle"><span class="checkmark"></span></label>
                  <label for="personal-area-toggle">Area Code</label>
                </div>
                <input type="text" id="personal-area" class="input-field" placeholder="Area code">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-phone-toggle"><span class="checkmark"></span></label>
                  <label for="personal-phone-toggle">Mobile Phone Number <span class="warning-tag">SENSITIVE</span></label>
                </div>
                <input type="text" id="personal-phone" class="input-field" placeholder="Enter phone number">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-address-toggle"><span class="checkmark"></span></label>
                  <label for="personal-address-toggle">Current Address</label>
                </div>
                <input type="text" id="personal-address" class="input-field" placeholder="Street, City, State">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-prev-address-toggle"><span class="checkmark"></span></label>
                  <label for="personal-prev-address-toggle">Previous Address</label>
                </div>
                <input type="text" id="personal-prev-address" class="input-field" placeholder="Previous address">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-postal-toggle"><span class="checkmark"></span></label>
                  <label for="personal-postal-toggle">Postal Code</label>
                </div>
                <input type="text" id="personal-postal" class="input-field" placeholder="Postal / ZIP">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-email-toggle"><span class="checkmark"></span></label>
                  <label for="personal-email-toggle">Email Address</label>
                </div>
                <input type="text" id="personal-email" class="input-field" placeholder="Enter email address">
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-additional-toggle"><span class="checkmark"></span></label>
                  <label for="personal-additional-toggle">Additional Information</label>
                </div>
                <textarea id="personal-additional" class="input-field" placeholder="Enter any additional personal information"></textarea>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-static-dynamic-toggle"><span class="checkmark"></span></label>
                  <label for="personal-static-dynamic-toggle">Static/Dynamic Assignment</label>
                </div>
                <input type="text" id="personal-static-dynamic" class="input-field" placeholder="Static or Dynamic IP assignment">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-ip-toggle"><span class="checkmark"></span></label>
                  <label for="personal-ip-toggle">Internet Protocol (IPv4/IPv6)</label>
                </div>
                <input type="text" id="personal-ip" class="input-field" placeholder="IPv4 or IPv6 address">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="personal-timezone-toggle"><span class="checkmark"></span></label>
                  <label for="personal-timezone-toggle">Timezone</label>
                </div>
                <input type="text" id="personal-timezone" class="input-field" placeholder="e.g. UTC-5">
              </div>
            </div>
          </div>

          <!-- Family Information Section -->
          <div id="section-family" class="section">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-users"></i> Family Information</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-mother-toggle"><span class="checkmark"></span></label>
                  <label for="family-mother-toggle">Mother</label>
                </div>
                <div class="family-member">
                  <h4>Mother</h4>
                  <input type="text" id="family-mother-name" class="input-field" placeholder="Mother's full name">
                  <input type="text" id="family-mother-picture" class="input-field" placeholder="URL to mother's picture" style="margin-top:10px;">
                  <input type="text" id="family-mother-dob" class="input-field" placeholder="Mother's DOB" style="margin-top:10px;">
                  <input type="text" id="family-mother-age" class="input-field" placeholder="Mother's age" style="margin-top:10px;">
                  <input type="text" id="family-mother-address" class="input-field" placeholder="Mother's current address" style="margin-top:10px;">
                  <input type="text" id="family-mother-emails" class="input-field" placeholder="Mother's email(s)" style="margin-top:10px;">
                  <textarea id="family-mother-additional" class="input-field" placeholder="Additional information about mother" style="margin-top:10px;"></textarea>
                </div>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-father-toggle"><span class="checkmark"></span></label>
                  <label for="family-father-toggle">Father</label>
                </div>
                <div class="family-member">
                  <h4>Father</h4>
                  <input type="text" id="family-father-name" class="input-field" placeholder="Father's full name">
                  <input type="text" id="family-father-picture" class="input-field" placeholder="URL to father's picture" style="margin-top:10px;">
                  <input type="text" id="family-father-dob" class="input-field" placeholder="Father's DOB" style="margin-top:10px;">
                  <input type="text" id="family-father-age" class="input-field" placeholder="Father's age" style="margin-top:10px;">
                  <input type="text" id="family-father-address" class="input-field" placeholder="Father's current address" style="margin-top:10px;">
                  <input type="text" id="family-father-emails" class="input-field" placeholder="Father's email(s)" style="margin-top:10px;">
                  <textarea id="family-father-additional" class="input-field" placeholder="Additional information about father" style="margin-top:10px;"></textarea>
                </div>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-son-toggle"><span class="checkmark"></span></label>
                  <label for="family-son-toggle">Son</label>
                </div>
                <div class="family-member">
                  <h4>Son</h4>
                  <input type="text" id="family-son-name" class="input-field" placeholder="Son's full name">
                  <input type="text" id="family-son-picture" class="input-field" placeholder="URL to son's picture" style="margin-top:10px;">
                  <input type="text" id="family-son-dob" class="input-field" placeholder="Son's DOB" style="margin-top:10px;">
                  <input type="text" id="family-son-age" class="input-field" placeholder="Son's age" style="margin-top:10px;">
                  <input type="text" id="family-son-address" class="input-field" placeholder="Son's current address" style="margin-top:10px;">
                  <input type="text" id="family-son-emails" class="input-field" placeholder="Son's email(s)" style="margin-top:10px;">
                  <textarea id="family-son-additional" class="input-field" placeholder="Additional information about son" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-daughter-toggle"><span class="checkmark"></span></label>
                  <label for="family-daughter-toggle">Daughter</label>
                </div>
                <div class="family-member">
                  <h4>Daughter</h4>
                  <input type="text" id="family-daughter-name" class="input-field" placeholder="Daughter's full name">
                  <input type="text" id="family-daughter-picture" class="input-field" placeholder="URL to daughter's picture" style="margin-top:10px;">
                  <input type="text" id="family-daughter-dob" class="input-field" placeholder="Daughter's DOB" style="margin-top:10px;">
                  <input type="text" id="family-daughter-age" class="input-field" placeholder="Daughter's age" style="margin-top:10px;">
                  <input type="text" id="family-daughter-address" class="input-field" placeholder="Daughter's current address" style="margin-top:10px;">
                  <input type="text" id="family-daughter-emails" class="input-field" placeholder="Daughter's email(s)" style="margin-top:10px;">
                  <textarea id="family-daughter-additional" class="input-field" placeholder="Additional information about daughter" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-grandma-toggle"><span class="checkmark"></span></label>
                  <label for="family-grandma-toggle">Grandma</label>
                </div>
                <div class="family-member">
                  <h4>Grandma</h4>
                  <input type="text" id="family-grandma-name" class="input-field" placeholder="Grandma's full name">
                  <input type="text" id="family-grandma-picture" class="input-field" placeholder="URL to grandma's picture" style="margin-top:10px;">
                  <input type="text" id="family-grandma-dob" class="input-field" placeholder="Grandma's DOB" style="margin-top:10px;">
                  <input type="text" id="family-grandma-age" class="input-field" placeholder="Grandma's age" style="margin-top:10px;">
                  <input type="text" id="family-grandma-address" class="input-field" placeholder="Grandma's current address" style="margin-top:10px;">
                  <input type="text" id="family-grandma-emails" class="input-field" placeholder="Grandma's email(s)" style="margin-top:10px;">
                  <textarea id="family-grandma-additional" class="input-field" placeholder="Additional information about grandma" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-grandpa-toggle"><span class="checkmark"></span></label>
                  <label for="family-grandpa-toggle">Grandpa</label>
                </div>
                <div class="family-member">
                  <h4>Grandpa</h4>
                  <input type="text" id="family-grandpa-name" class="input-field" placeholder="Grandpa's full name">
                  <input type="text" id="family-grandpa-picture" class="input-field" placeholder="URL to grandpa's picture" style="margin-top:10px;">
                  <input type="text" id="family-grandpa-dob" class="input-field" placeholder="Grandpa's DOB" style="margin-top:10px;">
                  <input type="text" id="family-grandpa-age" class="input-field" placeholder="Grandpa's age" style="margin-top:10px;">
                  <input type="text" id="family-grandpa-address" class="input-field" placeholder="Grandpa's current address" style="margin-top:10px;">
                  <input type="text" id="family-grandpa-emails" class="input-field" placeholder="Grandpa's email(s)" style="margin-top:10px;">
                  <textarea id="family-grandpa-additional" class="input-field" placeholder="Additional information about grandpa" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-sister-toggle"><span class="checkmark"></span></label>
                  <label for="family-sister-toggle">Sister</label>
                </div>
                <div class="family-member">
                  <h4>Sister</h4>
                  <input type="text" id="family-sister-name" class="input-field" placeholder="Sister's full name">
                  <input type="text" id="family-sister-picture" class="input-field" placeholder="URL to sister's picture" style="margin-top:10px;">
                  <input type="text" id="family-sister-dob" class="input-field" placeholder="Sister's DOB" style="margin-top:10px;">
                  <input type="text" id="family-sister-age" class="input-field" placeholder="Sister's age" style="margin-top:10px;">
                  <input type="text" id="family-sister-address" class="input-field" placeholder="Sister's current address" style="margin-top:10px;">
                  <input type="text" id="family-sister-phone" class="input-field" placeholder="Sister's phone number" style="margin-top:10px;">
                  <input type="text" id="family-sister-emails" class="input-field" placeholder="Sister's email(s)" style="margin-top:10px;">
                  <textarea id="family-sister-additional" class="input-field" placeholder="Additional information about sister" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-brother-toggle"><span class="checkmark"></span></label>
                  <label for="family-brother-toggle">Brother</label>
                </div>
                <div class="family-member">
                  <h4>Brother</h4>
                  <input type="text" id="family-brother-name" class="input-field" placeholder="Brother's full name">
                  <input type="text" id="family-brother-picture" class="input-field" placeholder="URL to brother's picture" style="margin-top:10px;">
                  <input type="text" id="family-brother-dob" class="input-field" placeholder="Brother's DOB" style="margin-top:10px;">
                  <input type="text" id="family-brother-age" class="input-field" placeholder="Brother's age" style="margin-top:10px;">
                  <input type="text" id="family-brother-address" class="input-field" placeholder="Brother's current address" style="margin-top:10px;">
                  <input type="text" id="family-brother-phone" class="input-field" placeholder="Brother's phone number" style="margin-top:10px;">
                  <input type="text" id="family-brother-emails" class="input-field" placeholder="Brother's email(s)" style="margin-top:10px;">
                  <textarea id="family-brother-additional" class="input-field" placeholder="Additional information about brother" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="family-siblings-toggle"><span class="checkmark"></span></label>
                  <label for="family-siblings-toggle">Siblings</label>
                </div>
                <textarea id="family-siblings" class="input-field" placeholder="Information about siblings"></textarea>
              </div>
            </div>
          </div>

          <!-- Education Section -->
          <div id="section-education" class="section">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-graduation-cap"></i> Educational Information</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="education-highschool-toggle"><span class="checkmark"></span></label>
                  <label for="education-highschool-toggle">High School</label>
                </div>
                <div class="education-level">
                  <input type="text" id="education-hs-name" class="input-field" placeholder="School name">
                  <input type="text" id="education-hs-location" class="input-field" placeholder="Location" style="margin-top:10px;">
                  <input type="text" id="education-hs-start" class="input-field" placeholder="Start date" style="margin-top:10px;">
                  <input type="text" id="education-hs-end" class="input-field" placeholder="End date" style="margin-top:10px;">
                  <input type="text" id="education-hs-degree" class="input-field" placeholder="Degree/diploma" style="margin-top:10px;">
                  <textarea id="education-hs-additional" class="input-field" placeholder="Additional high school information" style="margin-top:10px;"></textarea>
                </div>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="education-college-toggle"><span class="checkmark"></span></label>
                  <label for="education-college-toggle">College / University</label>
                </div>
                <div class="education-level">
                  <input type="text" id="education-college-name" class="input-field" placeholder="College/university name">
                  <input type="text" id="education-college-location" class="input-field" placeholder="Location" style="margin-top:10px;">
                  <input type="text" id="education-college-start" class="input-field" placeholder="Start date" style="margin-top:10px;">
                  <input type="text" id="education-college-end" class="input-field" placeholder="End date" style="margin-top:10px;">
                  <input type="text" id="education-college-degree" class="input-field" placeholder="Degree" style="margin-top:10px;">
                  <textarea id="education-college-additional" class="input-field" placeholder="Additional college information" style="margin-top:10px;"></textarea>
                </div>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="education-additional-toggle"><span class="checkmark"></span></label>
                  <label for="education-additional-toggle">Additional Educational Information</label>
                </div>
                <textarea id="education-additional" class="input-field" placeholder="Any additional education-related information"></textarea>
              </div>
            </div>
          </div>

          <!-- Socials Section -->
          <div id="section-socials" class="section">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-hashtag"></i> Socials</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-instagram-toggle"><span class="checkmark"></span></label>
                  <label for="socials-instagram-toggle"><i class="fab fa-instagram"></i> Instagram</label>
                </div>
                <input type="text" id="socials-instagram" class="input-field" placeholder="Username or URL">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-facebook-toggle"><span class="checkmark"></span></label>
                  <label for="socials-facebook-toggle"><i class="fab fa-facebook"></i> Facebook</label>
                </div>
                <input type="text" id="socials-facebook" class="input-field" placeholder="Profile URL">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-twitter-toggle"><span class="checkmark"></span></label>
                  <label for="socials-twitter-toggle"><i class="fab fa-twitter"></i> Twitter/X</label>
                </div>
                <input type="text" id="socials-twitter" class="input-field" placeholder="Username or URL">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-linkedin-toggle"><span class="checkmark"></span></label>
                  <label for="socials-linkedin-toggle"><i class="fab fa-linkedin"></i> LinkedIn</label>
                </div>
                <input type="text" id="socials-linkedin" class="input-field" placeholder="Profile URL">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-reddit-toggle"><span class="checkmark"></span></label>
                  <label for="socials-reddit-toggle"><i class="fab fa-reddit"></i> Reddit</label>
                </div>
                <input type="text" id="socials-reddit" class="input-field" placeholder="Username">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-tiktok-toggle"><span class="checkmark"></span></label>
                  <label for="socials-tiktok-toggle"><i class="fab fa-tiktok"></i> TikTok</label>
                </div>
                <input type="text" id="socials-tiktok" class="input-field" placeholder="Username">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-snapchat-toggle"><span class="checkmark"></span></label>
                  <label for="socials-snapchat-toggle"><i class="fab fa-snapchat"></i> Snapchat</label>
                </div>
                <input type="text" id="socials-snapchat" class="input-field" placeholder="Username">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-youtube-toggle"><span class="checkmark"></span></label>
                  <label for="socials-youtube-toggle"><i class="fab fa-youtube"></i> YouTube</label>
                </div>
                <input type="text" id="socials-youtube" class="input-field" placeholder="Channel URL or name">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-kick-toggle"><span class="checkmark"></span></label>
                  <label for="socials-kick-toggle"><i class="fas fa-gamepad"></i> Kick</label>
                </div>
                <input type="text" id="socials-kick" class="input-field" placeholder="Username or URL">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-discord-toggle"><span class="checkmark"></span></label>
                  <label for="socials-discord-toggle"><i class="fab fa-discord"></i> Discord</label>
                </div>
                <input type="text" id="socials-discord" class="input-field" placeholder="Username or ID">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-other-toggle"><span class="checkmark"></span></label>
                  <label for="socials-other-toggle"><i class="fas fa-globe"></i> Other Socials</label>
                </div>
                <textarea id="socials-other" class="input-field" placeholder="Other social media accounts"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="socials-additional-toggle"><span class="checkmark"></span></label>
                  <label for="socials-additional-toggle">Additional Social Information</label>
                </div>
                <textarea id="socials-additional" class="input-field" placeholder="Any additional social media information"></textarea>
              </div>
            </div>
          </div>

          <!-- Data Leaks Section -->
          <div id="section-leaks" class="section">
            <div class="section-header" onclick="this.parentNode.classList.toggle('active');" style="cursor: pointer;">
              <div class="section-title"><i class="section-icon fas fa-shield-alt"></i> Data Leaks</div>
              <i class="toggle-icon fas fa-chevron-down"></i>
            </div>
            <div class="section-content">
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-info-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-info-toggle">Leaked Information</label>
                </div>
                <textarea id="leaks-info" class="input-field" placeholder="Details about leaked information"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-source-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-source-toggle">Source of Leak</label>
                </div>
                <textarea id="leaks-source" class="input-field" placeholder="Where the data was leaked from"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-date-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-date-toggle">Date of Leak</label>
                </div>
                <input type="text" id="leaks-date" class="input-field" placeholder="When the leak occurred (YYYY-MM-DD)">
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-passwords-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-passwords-toggle">Known Password Leaks</label>
                </div>
                <textarea id="leaks-passwords" class="input-field" placeholder="One leaked password per line"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-databases-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-databases-toggle">Database Breaches</label>
                </div>
                <textarea id="leaks-databases" class="input-field" placeholder="List breached sites or databases"></textarea>
              </div>

              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-credit-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-credit-toggle">Credit Card Info <span class="warning-tag">SENSITIVE</span></label>
                </div>
                <textarea id="leaks-credit" class="input-field" placeholder="Last 4 digits only or notes"></textarea>
              </div>
              
              <div class="field-group">
                <div class="field-toggle">
                  <label class="checkbox-wrapper"><input type="checkbox" id="leaks-additional-toggle"><span class="checkmark"></span></label>
                  <label for="leaks-additional-toggle">Additional Information</label>
                </div>
                <textarea id="leaks-additional" class="input-field" placeholder="Any additional information about data leaks"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="panel templates-section">
          <h3>Templates</h3>
          <p>Choose a template to quickly fill in common information:</p>
          <div class="template-grid">
            
            <div class="template-card" data-template="oswald-main"><div class="template-preview"><i class="fas fa-file-alt"></i></div><div class="template-info"><h4 class="template-name">Oswald Main</h4><p class="template-description">Standard Oswald format</p></div></div>
          </div>
        </div>

        <div class="controls">
          <button id="generate-btn" class="btn btn-primary"><i class="fas fa-code"></i> Generate Format</button>
          <button id="copy-btn" class="btn btn-outline" onclick="copyOutputToClipboard(); return false;"><i class="fas fa-copy"></i> Copy to Clipboard</button>
          <button id="clear-btn" class="btn btn-secondary" onclick="clearAllFields(); return false;"><i class="fas fa-trash-alt"></i> Clear All</button>
          <button id="download-btn" class="btn btn-outline" onclick="downloadOutput(); return false;"><i class="fas fa-download"></i> Download</button>
        </div>
      </div>
      
      <div class="output-area">
        <div class="panel">
          <h3>Generated Output</h3>
          <div class="output-box">
            <div class="output-controls">
              <button class="output-btn" id="copy-output-btn" title="Copy" onclick="copyOutputToClipboard(); return false;">
                <i class="fas fa-copy"></i>
              </button>
              <button class="output-btn" id="download-output-btn" title="Download" onclick="downloadOutput(); return false;">
                <i class="fas fa-download"></i>
              </button>
              <button class="output-btn" id="clear-output-btn" title="Clear" onclick="clearOutputOnly(); return false;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <pre id="output-format" class="output-content"></pre>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="toast-container" id="toast-container">
    <!-- Toasts will be inserted here via JavaScript -->
  </div>
  
  <script>
    // Main script
    document.addEventListener('DOMContentLoaded', function() {
      // Theme toggle functionality has been moved to an inline script with the button
      // This avoids any potential conflicts with other JavaScript in the page
      
      // Tab navigation
      const tabButtons = document.querySelectorAll('.tab-btn');
      const sections = document.querySelectorAll('.section');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Remove active class from all tabs
          tabButtons.forEach(btn => btn.classList.remove('active'));

          // Add active class to clicked tab
          button.classList.add('active');
          
          // Get the section ID from the button's data-section attribute
          const sectionId = button.getAttribute('data-section');
          if (sectionId) {
            // Find the section and scroll to it
            const targetSection = document.getElementById('section-' + sectionId);
            if (targetSection) {
              // Scroll to the section smoothly
              targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
              
              // Open the section if it's not already open
              toggleSection(targetSection, true);
            }
          }
        });
      });
      
      // Original section toggle code removed - we'll use the enhanced version at the end of the script
      
      // Enable/disable inputs based on checkboxes that follow the "*-toggle" naming convention
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (!checkbox.id || !checkbox.id.endsWith('-toggle')) return;
        const fieldId = checkbox.id.replace(/-toggle$/, '');
        const field = document.getElementById(fieldId);
        
        if (field) {
          // Set initial state
          field.disabled = !checkbox.checked;
          
          // Add change listener
          checkbox.addEventListener('change', () => {
            field.disabled = !checkbox.checked;
          });
        }
      });
      
      // Generate button logic - COMPLETELY REWRITTEN
      document.getElementById('generate-btn').addEventListener('click', function() {
        console.clear(); 
        console.log('Generate button clicked - FIXED VERSION');
        
        // Show loading state
        this.innerHTML = '<span class="spinner"></span> Generating...';
        this.disabled = true;
        
        setTimeout(() => {
          try {
            // First ensure all checkboxes are checked and all sections are expanded
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
              checkbox.checked = true;
            });
            
            // Enable all inputs that are controlled by toggle checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
              if (checkbox.id && checkbox.id.endsWith('-toggle')) {
                const fieldId = checkbox.id.replace(/-toggle$/, '');
                const field = document.getElementById(fieldId);
                if (field) {
                  field.disabled = false;
                }
              }
            });
            
            // Expand all sections
            document.querySelectorAll('.section').forEach(section => {
              section.classList.add('active');
              const content = section.querySelector('.section-content');
              if (content) {
                content.style.display = 'block';
                content.style.height = 'auto';
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '18px 20px';
                content.style.overflow = 'visible';
              }
            });
            
            // Generate simple but complete output
            let output = "============================================\n";
            output += "          GENERATED INFORMATION FORMAT         \n";
            output += "============================================\n\n";
            
            // Process each section
            document.querySelectorAll('.section').forEach(section => {
              const sectionId = section.id || 'unknown';
              const sectionName = sectionId.replace('section-', '').toUpperCase();
              
              output += `### ${sectionName} INFORMATION ###\n\n`;
              
              // Get all text inputs and textareas in this section
              const inputs = section.querySelectorAll('input[type="text"], textarea');
              inputs.forEach(input => {
                if (input && input.id && input.value) {
                  // Extract field name from id
                  const fieldParts = input.id.split('-');
                  const fieldName = fieldParts[fieldParts.length - 1].toUpperCase();
                  output += `[${fieldName}] ${input.value}\n`;
                }
              });
              
              output += "\n";
            });
            
            output += "============================================\n";
            output += "          GENERATED WITH SIMPLE TOOL         \n";
            output += "============================================\n";
            
            // Display output in a safer way
            const outputDisplay = document.getElementById('output-format');
            if (outputDisplay) {
              outputDisplay.textContent = output;
              outputDisplay.style.display = 'block';
              
              // Scroll to output area
              const outputArea = document.querySelector('.output-area');
              if (outputArea) {
                outputArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
              
              // Show success message
              if (typeof showToast === 'function') {
                showToast('Success', 'Format generated successfully with ALL form data!', 'success');
              } else {
                alert('Format generated successfully!');
              }
            } else {
              throw new Error('Output element not found');
            }
          } catch(error) {
            console.error('Generation error:', error);
            
            // Show error in output area
            const outputElement = document.getElementById('output-format');
            if (outputElement) {
              outputElement.textContent = "Error generating format: " + error.message;
              outputElement.style.display = 'block';
              outputElement.style.color = 'red';
            }
            
            if (typeof showToast === 'function') {
              showToast('Error', `Failed to generate format: ${error.message}`, 'error');
            } else {
              alert(`Error: ${error.message}`);
            }
          }
          
          // Reset button state
          this.innerHTML = '<i class="fas fa-code"></i> Generate Format';
          this.disabled = false;
        }, 500);
      });
      
      // Copy button logic - now handled by the onclick attribute
      
      // Template button and its functionality have been removed
      
      // Copy output button - now handled by the onclick attribute
      
      // Download output button - now handled by the onclick attribute
      // Download button - now handled by the onclick attribute
      
      // Clear button logic - now handled by the onclick attribute
      
      // Clear output button - now handled by the onclick attribute
      
      // Save draft button removed
      
      // Template selection
      document.querySelectorAll('.template-card').forEach(card => {
        card.addEventListener('click', function() {
          // Remove active class from all template cards
          document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active-template'));
          
          // Add active class to this card
          this.classList.add('active-template');
          
          const templateType = this.getAttribute('data-template');
          applyTemplate(templateType);
          
          // Use Template button has been removed
          // No need to update button text or display
          
          // Provide user feedback
          showToast('Template Applied', `${templateType.charAt(0).toUpperCase() + templateType.slice(1)} template loaded`, 'success');
        });
      });
      
      // Guard emoji picker wiring: only enable if the elements exist (Style Options removed)
      const emojiPickerBtn = document.getElementById('emoji-picker-btn');
      if (emojiPickerBtn) {
        emojiPickerBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          const emojiPicker = document.getElementById('emoji-picker');
          if (emojiPicker) emojiPicker.style.display = emojiPicker.style.display === 'flex' ? 'none' : 'flex';
        });

        // Close emoji picker when clicking outside
        document.addEventListener('click', function(e) {
          const emojiPicker = document.getElementById('emoji-picker');
          if (!emojiPicker) return;
          if (e.target !== emojiPickerBtn && !emojiPicker.contains(e.target)) {
            emojiPicker.style.display = 'none';
          }
        });

        // Populate emoji picker
        populateEmojiPicker();
      }
      
      // Helper function to safely get element values
      function safeGetElementValue(id) {
        try {
          const element = document.getElementById(id);
          if (!element) {
            console.warn(`Element with ID '${id}' not found`);
            return '';
          }
          console.log(`Getting value for element ${id}: ${element.value ? 'Has value' : 'Empty'}`);
          return element.value || '';
        } catch (err) {
          console.error(`Error getting value for element ${id}:`, err);
          return '';
        }
      }
      
      // Helper function to safely check if an element is checked
      function safeIsElementChecked(id) {
        try {
          const element = document.getElementById(id);
          return element ? (element.checked || false) : false;
        } catch (err) {
          console.error(`Error checking if element ${id} is checked:`, err);
          return false;
        }
      }
      
      // Main output generation function
      function generateFormattedOutput() {
        console.log("Starting generateFormattedOutput function...");
        
        try {
          // Force call forceCheckAllAndExpandSections to ensure all sections are expanded
          if (typeof forceCheckAllAndExpandSections === 'function') {
            console.log("Forcing check all and expand sections from generateFormattedOutput");
            forceCheckAllAndExpandSections();
          }
          
          // Log all active sections to debug why some sections might not be included
          const sections = document.querySelectorAll('.section-content');
          console.log('Sections found:', sections.length);
          sections.forEach(section => {
            console.log(`Section ID: ${section.id}, Active: ${section.classList.contains('active')}, Fields: ${section.querySelectorAll('input, textarea').length}`);
          });
          
          // Style controls were removed from the page; use safe defaults if missing.
          const styleSelect = document.getElementById('style-format');
          const styleFormat = styleSelect ? styleSelect.value : 'modern';
          console.log('Style format:', styleFormat);
          const emojiCheckbox = document.getElementById('style-emojis');
          const includeEmojis = emojiCheckbox ? emojiCheckbox.checked : false;
          console.log('Include emojis:', includeEmojis);
        
        let output = '';
        
        // Choose header style based on format
        if (styleFormat === 'ascii') {
          output += '╔══════════════════════════════════════════╗\n';
          output += '║          7fx8\'s DOX FORMAT [PREMIUM]     ║\n';
          output += '╚══════════════════════════════════════════╝\n\n';
        } else if (styleFormat === 'modern') {
          output += '┌─────────────────────────────────────────┐\n';
          output += '│        7fx8\'s DOX FORMAT [PREMIUM]      │\n';
          output += '└─────────────────────────────────────────┘\n\n';
        } else if (styleFormat === 'minimal') {
          output += '# 7fx8\'s DOX FORMAT [PREMIUM]\n\n';
          output += '----------------------------------------\n\n';
        } else if (styleFormat === 'fancy') {
          output += '•❅──────✧❅✦❅✧──────❅•\n';
          output += '   7fx8\'s DOX FORMAT [PREMIUM]\n';
          output += '•❅──────✧❅✦❅✧──────❅•\n\n';
        }
        
        // If a selected ASCII template (from Templates) exists, use it as base and fill placeholders.
        console.log('Checking for selected ASCII template...');
        try {
          const selectedAscii = window._selectedAsciiTemplate || null;
          console.log('Selected ASCII template:', selectedAscii ? 'Found (length: ' + selectedAscii.length + ')' : 'None');
          
          // Get the generate button safely
          const generateBtn = document.getElementById('generate-btn');
          const isFromGenerateBtn = generateBtn && generateBtn.disabled;
          
          // We will NOT use a template for the Generate Format button - that button should always show ALL data
          if (selectedAscii && isFromGenerateBtn) {
            console.log('WARNING: Selected ASCII template found but this is from the Generate Format button. Ignoring template to show ALL data.');
          } else if (selectedAscii) {
            console.log('Using selected ASCII template to fill placeholders...');
            // Replace placeholders like {{fieldId}} with current values (or empty string) and return.
            let filled = selectedAscii.replace(/{{(.*?)}}/g, (match, p1) => {
              const fieldId = p1.trim();
              const fieldValue = safeGetElementValue(fieldId);
              console.log(`Replacing placeholder ${fieldId} with value: ${fieldValue.substring(0, 20)}${fieldValue.length > 20 ? '...' : ''}`);
              return fieldValue;
            });
            // Append footer note
            filled += '\n\n-- Generated with 7fx8\'s Tool';
            console.log('Returning filled template');
            return filled;
          }
        } catch (err) {
          console.error('Error processing template:', err);
        }

        // Basic Information
        const sectionEmoji = includeEmojis ? '👤 ' : '';
        console.log('Checking Basic Information section');
        // When using "Generate Format" button, include ALL sections regardless of their active state
        const basicSection = document.getElementById('section-basic');
        const isGenerateButton = document.getElementById('generate-btn').disabled;
        if (basicSection && (basicSection.classList.contains('active') || isGenerateButton)) {
          console.log('Including Basic Information section');
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${sectionEmoji}BASIC INFORMATION ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${sectionEmoji}BASIC INFORMATION\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${sectionEmoji}BASIC INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          try {
            const pictureToggle = document.getElementById('basic-picture-toggle');
            const pictureField = document.getElementById('basic-picture');
            
            if (pictureToggle && pictureField && pictureToggle.checked && pictureField.value) {
              const picEmoji = includeEmojis ? '🖼️ ' : '';
              output += `➤ [PICTURE] ${picEmoji}${pictureField.value}\n`;
            }
          } catch (err) {
            console.error('Error processing picture field:', err);
          }
          
          try {
            const nameToggle = document.getElementById('basic-name-toggle');
            const nameField = document.getElementById('basic-name');
            
            if (nameToggle && nameField && nameToggle.checked && nameField.value) {
              const nameEmoji = includeEmojis ? '📝 ' : '';
              output += `➤ [NAME] ${nameEmoji}${nameField.value}\n`;
            }
          } catch (err) {
            console.error('Error processing name field:', err);
          }
          
          try {
            if (safeIsElementChecked('basic-pseudonyms-toggle') && safeGetElementValue('basic-pseudonyms')) {
              const akaEmoji = includeEmojis ? '🔤 ' : '';
              output += `➤ [PSEUDONYMS] ${akaEmoji}${safeGetElementValue('basic-pseudonyms')}\n`;
            }
          } catch (err) {
            console.error('Error processing pseudonyms field:', err);
          }
          
          try {
            const reasonToggle = document.getElementById('basic-reason-toggle');
            const reasonField = document.getElementById('basic-reason');
            
            if (reasonToggle && reasonField && reasonToggle.checked && reasonField.value) {
              const reasonEmoji = includeEmojis ? '⚠️ ' : '';
              const reasonValue = reasonField.value;
              
              if (styleFormat === 'ascii') {
                output += '▄▄▄▄▄▄▄▄▄▄ REASON ▄▄▄▄▄▄▄▄▄▄\n';
                output += `${reasonEmoji}${reasonValue}\n`;
                output += '▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄\n';
              } else if (styleFormat === 'modern') {
                output += '┌─────────── REASON ───────────┐\n';
                output += `${reasonEmoji}${reasonValue}\n`;
                output += '└──────────────────────────────┘\n';
              } else if (styleFormat === 'minimal') {
                output += '### REASON\n';
                output += `${reasonEmoji}${reasonValue}\n\n`;
              } else if (styleFormat === 'fancy') {
                output += '✧ REASON ✧\n';
                output += `${reasonEmoji}${reasonValue}\n\n`;
              }
            }
          } catch (err) {
            console.error('Error processing reason field:', err);
          }
          
          if (document.getElementById('basic-age-toggle').checked && document.getElementById('basic-age').value) {
            const ageEmoji = includeEmojis ? '🔢 ' : '';
            output += `➤ [AGE] ${ageEmoji}${document.getElementById('basic-age').value}\n`;
          }
          
          if (document.getElementById('basic-dob-toggle').checked && document.getElementById('basic-dob').value) {
            const dobEmoji = includeEmojis ? '📅 ' : '';
            output += `➤ [DATE OF BIRTH] ${dobEmoji}${document.getElementById('basic-dob').value}\n`;
          }
          
          output += '\n';
        }

        // Personal Information
        const personalEmoji = includeEmojis ? '🪪 ' : '';
        try {
          const personalSection = document.getElementById('section-personal');
          if (personalSection && personalSection.classList.contains('active')) {
            if (styleFormat === 'ascii' || styleFormat === 'modern') {
              output += `██████████ ${personalEmoji}PERSONAL INFORMATION ██████████\n\n`;
            } else if (styleFormat === 'minimal') {
              output += `## ${personalEmoji}PERSONAL INFORMATION\n\n`;
            } else if (styleFormat === 'fancy') {
              output += `✧･ﾟ: *✧･ﾟ:* ${personalEmoji}PERSONAL INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
            }
            
            try {
              const citizenToggle = document.getElementById('personal-citizenship-toggle');
              const citizenField = document.getElementById('personal-citizenship');
              
              if (citizenToggle && citizenField && citizenToggle.checked && citizenField.value) {
                const citizenEmoji = includeEmojis ? '🌎 ' : '';
                output += `➤ [CITIZENSHIP] ${citizenEmoji}${citizenField.value}\n`;
              }
            } catch (err) {
              console.error('Error processing citizenship field:', err);
            }
            
            try {
              const ssnToggle = document.getElementById('personal-ssn-toggle');
              const ssnField = document.getElementById('personal-ssn');
              
              if (ssnToggle && ssnField && ssnToggle.checked && ssnField.value) {
                const ssnEmoji = includeEmojis ? '🔢 ' : '';
                output += `➤ [SSN] ${ssnEmoji}${ssnField.value}\n`;
              }
            } catch (err) {
              console.error('Error processing SSN field:', err);
            }
          }
        } catch (err) {
          console.error('Error processing personal section:', err);
        }
        
        // Additional fields - fixed syntax issue
        try {          
          const dlnToggle = document.getElementById('personal-dln-toggle');
          const dlnField = document.getElementById('personal-dln');
          if (dlnToggle && dlnField && dlnToggle.checked && dlnField.value) {
            const dlnEmoji = includeEmojis ? '🚗 ' : '';
            output += `➤ [DRIVER'S LICENSE] ${dlnEmoji}${dlnField.value}\n`;
          }
          
          const ispToggle = document.getElementById('personal-isp-toggle');
          const ispField = document.getElementById('personal-isp');
          if (ispToggle && ispField && ispToggle.checked && ispField.value) {
            const ispEmoji = includeEmojis ? '📡 ' : '';
            output += `➤ [ISP] ${ispEmoji}${ispField.value}\n`;
          }
        } catch (err) {
          console.error('Error processing additional personal fields:', err);
        }
          
          if (document.getElementById('personal-ip-toggle').checked && document.getElementById('personal-ip').value) {
            const ipEmoji = includeEmojis ? '🌐 ' : '';
            output += `➤ [IP ADDRESS] ${ipEmoji}${document.getElementById('personal-ip').value}\n`;
          }
          
          if (document.getElementById('personal-address-toggle').checked && document.getElementById('personal-address').value) {
            const addressEmoji = includeEmojis ? '🏠 ' : '';
            output += `➤ [ADDRESS] ${addressEmoji}${document.getElementById('personal-address').value}\n`;
          }
          
          if (document.getElementById('personal-phone-toggle').checked && document.getElementById('personal-phone').value) {
            const phoneEmoji = includeEmojis ? '📱 ' : '';
            output += `➤ [PHONE] ${phoneEmoji}${document.getElementById('personal-phone').value}\n`;
          }
          
          if (document.getElementById('personal-email-toggle').checked && document.getElementById('personal-email').value) {
            const emailEmoji = includeEmojis ? '📧 ' : '';
            output += `➤ [EMAIL] ${emailEmoji}${document.getElementById('personal-email').value}\n`;
          }
          
          output += '\n';
        }
        
        // Family Information
        try {
          const familyEmojiText = includeEmojis ? '👪 ' : '';
          const familySection = document.getElementById('section-family');
          if (familySection && familySection.classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${familyEmojiText}FAMILY INFORMATION ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${familyEmojiText}FAMILY INFORMATION\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${familyEmojiText}FAMILY INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // Father
          if (document.getElementById('family-father-toggle').checked) {
            const fatherEmoji = includeEmojis ? '👨 ' : '';
            output += `【 ${fatherEmoji}FATHER 】\n`;
            
            if (document.getElementById('family-father-name').value) {
              output += `➤ [NAME] ${document.getElementById('family-father-name').value}\n`;
            }
            
            if (document.getElementById('family-father-age').value) {
              output += `➤ [AGE] ${document.getElementById('family-father-age').value}\n`;
            }
            
            if (document.getElementById('family-father-job').value) {
              output += `➤ [OCCUPATION] ${document.getElementById('family-father-job').value}\n`;
            }
            
            if (document.getElementById('family-father-address').value) {
              output += `➤ [ADDRESS] ${document.getElementById('family-father-address').value}\n`;
            }
            
            if (document.getElementById('family-father-phone').value) {
              output += `➤ [PHONE] ${document.getElementById('family-father-phone').value}\n`;
            }
            
            output += '\n';
          }
          
          // Mother
          if (document.getElementById('family-mother-toggle').checked) {
            const motherEmoji = includeEmojis ? '👩 ' : '';
            output += `【 ${motherEmoji}MOTHER 】\n`;
            
            if (document.getElementById('family-mother-name').value) {
              output += `➤ [NAME] ${document.getElementById('family-mother-name').value}\n`;
            }
            
            if (document.getElementById('family-mother-age').value) {
              output += `➤ [AGE] ${document.getElementById('family-mother-age').value}\n`;
            }
            
            if (document.getElementById('family-mother-job').value) {
              output += `➤ [OCCUPATION] ${document.getElementById('family-mother-job').value}\n`;
            }
            
            if (document.getElementById('family-mother-address').value) {
              output += `➤ [ADDRESS] ${document.getElementById('family-mother-address').value}\n`;
            }
            
            if (document.getElementById('family-mother-phone').value) {
              output += `➤ [PHONE] ${document.getElementById('family-mother-phone').value}\n`;
            }
            
            output += '\n';
          }
          
          // Siblings
          if (document.getElementById('family-sibling-toggle').checked) {
            const siblingEmoji = includeEmojis ? '👫 ' : '';
            output += `【 ${siblingEmoji}SIBLINGS 】\n`;
            
            if (document.getElementById('family-sibling-details').value) {
              output += `${document.getElementById('family-sibling-details').value}\n`;
            }
            
            output += '\n';
          }
          
          // Spouse
          if (document.getElementById('family-spouse-toggle').checked) {
            const spouseEmoji = includeEmojis ? '💑 ' : '';
            output += `【 ${spouseEmoji}SPOUSE/PARTNER 】\n`;
            
            if (document.getElementById('family-spouse-name').value) {
              output += `➤ [NAME] ${document.getElementById('family-spouse-name').value}\n`;
            }
            
            if (document.getElementById('family-spouse-age').value) {
              output += `➤ [AGE] ${document.getElementById('family-spouse-age').value}\n`;
            }
            
            if (document.getElementById('family-spouse-job').value) {
              output += `➤ [OCCUPATION] ${document.getElementById('family-spouse-job').value}\n`;
            }
            
            output += '\n';
          }
          
          // Children
          if (document.getElementById('family-children-toggle').checked) {
            const childrenEmoji = includeEmojis ? '👶 ' : '';
            output += `【 ${childrenEmoji}CHILDREN 】\n`;
            
            if (document.getElementById('family-children-details').value) {
              output += `${document.getElementById('family-children-details').value}\n`;
            }
            
            output += '\n';
          }
          
          output += '\n';
        }
        } catch (err) {
          console.error('Error processing family section:', err);
        }
        
        // Educational Information
        try {
          const educationEmojiText = includeEmojis ? '🎓 ' : '';
          const educationSection = document.getElementById('section-education');
          if (educationSection && educationSection.classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${educationEmojiText}EDUCATIONAL INFORMATION ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${educationEmojiText}EDUCATIONAL INFORMATION\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${educationEmojiText}EDUCATIONAL INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // High School
          if (document.getElementById('education-highschool-toggle').checked) {
            const hsEmoji = includeEmojis ? '🏫 ' : '';
            output += `【 ${hsEmoji}HIGH SCHOOL 】\n`;
            
            if (document.getElementById('education-highschool-name').value) {
              output += `➤ [SCHOOL NAME] ${document.getElementById('education-highschool-name').value}\n`;
            }
            
            if (document.getElementById('education-highschool-location').value) {
              output += `➤ [LOCATION] ${document.getElementById('education-highschool-location').value}\n`;
            }
            
            if (document.getElementById('education-highschool-graduation').value) {
              output += `➤ [GRADUATION YEAR] ${document.getElementById('education-highschool-graduation').value}\n`;
            }
            
            output += '\n';
          }
          
          // College
          if (document.getElementById('education-college-toggle').checked) {
            const collegeEmoji = includeEmojis ? '🎓 ' : '';
            output += `【 ${collegeEmoji}COLLEGE/UNIVERSITY 】\n`;
            
            if (document.getElementById('education-college-name').value) {
              output += `➤ [INSTITUTION NAME] ${document.getElementById('education-college-name').value}\n`;
            }
            
            if (document.getElementById('education-college-location').value) {
              output += `➤ [LOCATION] ${document.getElementById('education-college-location').value}\n`;
            }
            
            if (document.getElementById('education-college-degree').value) {
              output += `➤ [DEGREE] ${document.getElementById('education-college-degree').value}\n`;
            }
            
            if (document.getElementById('education-college-graduation').value) {
              output += `➤ [GRADUATION YEAR] ${document.getElementById('education-college-graduation').value}\n`;
            }
            
            output += '\n';
          }
          
          output += '\n';
        }
          
        // Add more field processing here based on styleFormat
        
        // Family Information Section
        const familyEmojiSection = includeEmojis ? '👪 ' : '';
        if (document.getElementById('section-family').classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${familyEmojiSection}FAMILY INFORMATION ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${familyEmojiSection}FAMILY INFORMATION\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${familyEmojiSection}FAMILY INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // Parents
          if (document.getElementById('family-parent-toggle').checked) {
            const parentsEmoji = includeEmojis ? '👨‍👩‍ ' : '';
            output += `➤ [PARENTS] ${parentsEmoji}\n`;
            
            // Mother
            if (document.getElementById('family-mother-name').value) {
              const motherEmoji = includeEmojis ? '👩 ' : '';
              output += `   ➣ Mother: ${motherEmoji}${document.getElementById('family-mother-name').value}\n`;
              
              if (document.getElementById('family-mother-dob').value) {
                output += `     ◦ DOB: ${document.getElementById('family-mother-dob').value}\n`;
              }
              
              if (document.getElementById('family-mother-location').value) {
                output += `     ◦ Location: ${document.getElementById('family-mother-location').value}\n`;
              }
              
              if (document.getElementById('family-mother-phone').value) {
                output += `     ◦ Phone: ${document.getElementById('family-mother-phone').value}\n`;
              }
              
              if (document.getElementById('family-mother-email').value) {
                output += `     ◦ Email: ${document.getElementById('family-mother-email').value}\n`;
              }
              
              if (document.getElementById('family-mother-occupation').value) {
                output += `     ◦ Occupation: ${document.getElementById('family-mother-occupation').value}\n`;
              }
            }
            
            // Father
            if (document.getElementById('family-father-name').value) {
              const fatherEmoji = includeEmojis ? '👨 ' : '';
              output += `   ➣ Father: ${fatherEmoji}${document.getElementById('family-father-name').value}\n`;
              
              if (document.getElementById('family-father-dob').value) {
                output += `     ◦ DOB: ${document.getElementById('family-father-dob').value}\n`;
              }
              
              if (document.getElementById('family-father-location').value) {
                output += `     ◦ Location: ${document.getElementById('family-father-location').value}\n`;
              }
              
              if (document.getElementById('family-father-phone').value) {
                output += `     ◦ Phone: ${document.getElementById('family-father-phone').value}\n`;
              }
              
              if (document.getElementById('family-father-email').value) {
                output += `     ◦ Email: ${document.getElementById('family-father-email').value}\n`;
              }
              
              if (document.getElementById('family-father-occupation').value) {
                output += `     ◦ Occupation: ${document.getElementById('family-father-occupation').value}\n`;
              }
            }
          }
          
          // Siblings
          if (document.getElementById('family-sibling-toggle').checked && document.getElementById('family-sibling1-name').value) {
            const siblingEmoji = includeEmojis ? '👥 ' : '';
            output += `\n➤ [SIBLINGS] ${siblingEmoji}\n`;
            output += `   ➣ ${document.getElementById('family-sibling1-name').value}\n`;
            
            if (document.getElementById('family-sibling1-dob').value) {
              output += `     ◦ DOB: ${document.getElementById('family-sibling1-dob').value}\n`;
            }
            
            if (document.getElementById('family-sibling1-location').value) {
              output += `     ◦ Location: ${document.getElementById('family-sibling1-location').value}\n`;
            }
            
            if (document.getElementById('family-sibling1-phone').value) {
              output += `     ◦ Phone: ${document.getElementById('family-sibling1-phone').value}\n`;
            }
            
            if (document.getElementById('family-sibling1-email').value) {
              output += `     ◦ Email: ${document.getElementById('family-sibling1-email').value}\n`;
            }
            
            if (document.getElementById('family-sibling1-social').value) {
              output += `     ◦ Social: ${document.getElementById('family-sibling1-social').value}\n`;
            }
          }
          
          // Spouse/Partner
          if (document.getElementById('family-spouse-toggle').checked && document.getElementById('family-spouse-name').value) {
            const spouseEmoji = includeEmojis ? '💑 ' : '';
            output += `\n➤ [SPOUSE/PARTNER] ${spouseEmoji}\n`;
            output += `   ➣ ${document.getElementById('family-spouse-name').value}\n`;
            
            if (document.getElementById('family-spouse-dob').value) {
              output += `     ◦ DOB: ${document.getElementById('family-spouse-dob').value}\n`;
            }
            
            if (document.getElementById('family-spouse-location').value) {
              output += `     ◦ Location: ${document.getElementById('family-spouse-location').value}\n`;
            }
            
            if (document.getElementById('family-spouse-phone').value) {
              output += `     ◦ Phone: ${document.getElementById('family-spouse-phone').value}\n`;
            }
            
            if (document.getElementById('family-spouse-email').value) {
              output += `     ◦ Email: ${document.getElementById('family-spouse-email').value}\n`;
            }
            
            if (document.getElementById('family-spouse-social').value) {
              output += `     ◦ Social: ${document.getElementById('family-spouse-social').value}\n`;
            }
            
            if (document.getElementById('family-marriage-date').value) {
              output += `     ◦ Marriage/Relationship Date: ${document.getElementById('family-marriage-date').value}\n`;
            }
          }
          
          // Children
          if (document.getElementById('family-children-toggle').checked && document.getElementById('family-child1-name').value) {
            const childEmoji = includeEmojis ? '👶 ' : '';
            output += `\n➤ [CHILDREN] ${childEmoji}\n`;
            output += `   ➣ ${document.getElementById('family-child1-name').value}\n`;
            
            if (document.getElementById('family-child1-dob').value) {
              output += `     ◦ DOB: ${document.getElementById('family-child1-dob').value}\n`;
            }
            
            if (document.getElementById('family-child1-location').value) {
              output += `     ◦ Location: ${document.getElementById('family-child1-location').value}\n`;
            }
            
            if (document.getElementById('family-child1-school').value) {
              output += `     ◦ School: ${document.getElementById('family-child1-school').value}\n`;
            }
          }
          
          // Extended Family
          if (document.getElementById('family-extended-toggle').checked && document.getElementById('family-extended').value) {
            const extFamilyEmoji = includeEmojis ? '👨‍👩‍👧‍👦 ' : '';
            output += `\n➤ [EXTENDED FAMILY] ${extFamilyEmoji}\n`;
            output += `   ${document.getElementById('family-extended').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Additional Family Info
          if (document.getElementById('family-additional-toggle').checked && document.getElementById('family-additional').value) {
            output += `\n➤ [ADDITIONAL FAMILY INFORMATION]\n`;
            output += `   ${document.getElementById('family-additional').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          output += '\n';
        }
        
        // Educational Information Section
        const educationEmojiSection = includeEmojis ? '🎓 ' : '';
        if (document.getElementById('section-education').classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${educationEmojiSection}EDUCATIONAL INFORMATION ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${educationEmojiSection}EDUCATIONAL INFORMATION\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${educationEmojiSection}EDUCATIONAL INFORMATION *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // Elementary School
          if (document.getElementById('education-elementary-toggle').checked && document.getElementById('education-elementary-name').value) {
            const elemEmoji = includeEmojis ? '🏫 ' : '';
            output += `➤ [ELEMENTARY SCHOOL] ${elemEmoji}\n`;
            output += `   ➣ School: ${document.getElementById('education-elementary-name').value}\n`;
            
            if (document.getElementById('education-elementary-years').value) {
              output += `     ◦ Years: ${document.getElementById('education-elementary-years').value}\n`;
            }
            
            if (document.getElementById('education-elementary-location').value) {
              output += `     ◦ Location: ${document.getElementById('education-elementary-location').value}\n`;
            }
            
            if (document.getElementById('education-elementary-teacher').value) {
              output += `     ◦ Teachers: ${document.getElementById('education-elementary-teacher').value}\n`;
            }
            
            if (document.getElementById('education-elementary-activities').value) {
              output += `     ◦ Activities: ${document.getElementById('education-elementary-activities').value}\n`;
            }
          }
          
          // Middle School
          if (document.getElementById('education-middle-toggle').checked && document.getElementById('education-middle-name').value) {
            const midEmoji = includeEmojis ? '🏫 ' : '';
            output += `\n➤ [MIDDLE SCHOOL] ${midEmoji}\n`;
            output += `   ➣ School: ${document.getElementById('education-middle-name').value}\n`;
            
            if (document.getElementById('education-middle-years').value) {
              output += `     ◦ Years: ${document.getElementById('education-middle-years').value}\n`;
            }
            
            if (document.getElementById('education-middle-location').value) {
              output += `     ◦ Location: ${document.getElementById('education-middle-location').value}\n`;
            }
            
            if (document.getElementById('education-middle-teacher').value) {
              output += `     ◦ Teachers: ${document.getElementById('education-middle-teacher').value}\n`;
            }
            
            if (document.getElementById('education-middle-activities').value) {
              output += `     ◦ Activities: ${document.getElementById('education-middle-activities').value}\n`;
            }
          }
          
          // High School
          if (document.getElementById('education-schools-toggle').checked && document.getElementById('education-hs-name').value) {
            const hsEmoji = includeEmojis ? '🏫 ' : '';
            output += `\n➤ [HIGH SCHOOL] ${hsEmoji}\n`;
            output += `   ➣ School: ${document.getElementById('education-hs-name').value}\n`;
            
            if (document.getElementById('education-hs-years').value) {
              output += `     ◦ Years: ${document.getElementById('education-hs-years').value}\n`;
            }
            
            if (document.getElementById('education-hs-location').value) {
              output += `     ◦ Location: ${document.getElementById('education-hs-location').value}\n`;
            }
            
            if (document.getElementById('education-hs-gpa').value) {
              output += `     ◦ GPA: ${document.getElementById('education-hs-gpa').value}\n`;
            }
            
            if (document.getElementById('education-hs-activities').value) {
              output += `     ◦ Activities: ${document.getElementById('education-hs-activities').value}\n`;
            }
            
            if (document.getElementById('education-hs-achievements').value) {
              output += `     ◦ Achievements: ${document.getElementById('education-hs-achievements').value}\n`;
            }
            
            if (document.getElementById('education-hs-friends').value) {
              output += `     ◦ Friends/Classmates: ${document.getElementById('education-hs-friends').value}\n`;
            }
          }
          
          // College / University
          if (document.getElementById('education-college-toggle').checked && document.getElementById('education-college-name').value) {
            const collegeEmoji = includeEmojis ? '🎓 ' : '';
            output += `\n➤ [COLLEGE/UNIVERSITY] ${collegeEmoji}\n`;
            output += `   ➣ Institution: ${document.getElementById('education-college-name').value}\n`;
            
            if (document.getElementById('education-college-degree').value) {
              output += `     ◦ Degree: ${document.getElementById('education-college-degree').value}\n`;
            }
            
            if (document.getElementById('education-college-minor').value) {
              output += `     ◦ Minor: ${document.getElementById('education-college-minor').value}\n`;
            }
            
            if (document.getElementById('education-college-years').value) {
              output += `     ◦ Years: ${document.getElementById('education-college-years').value}\n`;
            }
            
            if (document.getElementById('education-college-location').value) {
              output += `     ◦ Location: ${document.getElementById('education-college-location').value}\n`;
            }
            
            if (document.getElementById('education-college-gpa').value) {
              output += `     ◦ GPA: ${document.getElementById('education-college-gpa').value}\n`;
            }
            
            if (document.getElementById('education-college-activities').value) {
              output += `     ◦ Activities: ${document.getElementById('education-college-activities').value}\n`;
            }
            
            if (document.getElementById('education-college-achievements').value) {
              output += `     ◦ Achievements: ${document.getElementById('education-college-achievements').value}\n`;
            }
            
            if (document.getElementById('education-college-thesis').value) {
              output += `     ◦ Thesis/Project: ${document.getElementById('education-college-thesis').value}\n`;
            }
          }
          
          // Graduate School
          if (document.getElementById('education-grad-toggle').checked && document.getElementById('education-grad-name').value) {
            const gradEmoji = includeEmojis ? '🧑‍🎓 ' : '';
            output += `\n➤ [GRADUATE SCHOOL] ${gradEmoji}\n`;
            output += `   ➣ Institution: ${document.getElementById('education-grad-name').value}\n`;
            
            if (document.getElementById('education-grad-degree').value) {
              output += `     ◦ Degree: ${document.getElementById('education-grad-degree').value}\n`;
            }
            
            if (document.getElementById('education-grad-field').value) {
              output += `     ◦ Field: ${document.getElementById('education-grad-field').value}\n`;
            }
            
            if (document.getElementById('education-grad-years').value) {
              output += `     ◦ Years: ${document.getElementById('education-grad-years').value}\n`;
            }
            
            if (document.getElementById('education-grad-location').value) {
              output += `     ◦ Location: ${document.getElementById('education-grad-location').value}\n`;
            }
            
            if (document.getElementById('education-grad-advisor').value) {
              output += `     ◦ Advisor: ${document.getElementById('education-grad-advisor').value}\n`;
            }
            
            if (document.getElementById('education-grad-dissertation').value) {
              output += `     ◦ Dissertation: ${document.getElementById('education-grad-dissertation').value}\n`;
            }
            
            if (document.getElementById('education-grad-publications').value) {
              output += `     ◦ Publications: ${document.getElementById('education-grad-publications').value}\n`;
            }
          }
          
          // Certifications & Training
          if (document.getElementById('education-certifications-toggle').checked && document.getElementById('education-certifications').value) {
            const certEmoji = includeEmojis ? '📜 ' : '';
            output += `\n➤ [CERTIFICATIONS & TRAINING] ${certEmoji}\n`;
            output += `   ${document.getElementById('education-certifications').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Skills & Competencies
          if (document.getElementById('education-skills-toggle').checked && document.getElementById('education-skills').value) {
            const skillsEmoji = includeEmojis ? '🛠️ ' : '';
            output += `\n➤ [SKILLS & COMPETENCIES] ${skillsEmoji}\n`;
            output += `   ${document.getElementById('education-skills').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Online Learning
          if (document.getElementById('education-online-toggle').checked && document.getElementById('education-online').value) {
            const onlineEmoji = includeEmojis ? '💻 ' : '';
            output += `\n➤ [ONLINE LEARNING] ${onlineEmoji}\n`;
            output += `   ${document.getElementById('education-online').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Additional Educational Info
          if (document.getElementById('education-additional-toggle').checked && document.getElementById('education-additional').value) {
            output += `\n➤ [ADDITIONAL EDUCATIONAL INFORMATION]\n`;
            output += `   ${document.getElementById('education-additional').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          output += '\n';
        }
        } catch (err) {
          console.error('Error processing education section:', err);
        }

        // Socials Section
        try {
          const socialsEmoji = includeEmojis ? '📱 ' : '';
          const socialsSection = document.getElementById('section-socials');
          if (socialsSection && socialsSection.classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${socialsEmoji}SOCIALS ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${socialsEmoji}SOCIALS\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${socialsEmoji}SOCIALS *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // Instagram
          if (document.getElementById('socials-instagram-toggle').checked && document.getElementById('socials-instagram').value) {
            const igEmoji = includeEmojis ? '📸 ' : '';
            output += `➤ [INSTAGRAM] ${igEmoji}${document.getElementById('socials-instagram').value}\n`;
          }
          
          // Facebook
          if (document.getElementById('socials-facebook-toggle').checked && document.getElementById('socials-facebook').value) {
            const fbEmoji = includeEmojis ? '👥 ' : '';
            output += `➤ [FACEBOOK] ${fbEmoji}${document.getElementById('socials-facebook').value}\n`;
          }
          
          // Twitter/X
          if (document.getElementById('socials-twitter-toggle').checked && document.getElementById('socials-twitter').value) {
            const twitterEmoji = includeEmojis ? '🐦 ' : '';
            output += `➤ [TWITTER/X] ${twitterEmoji}${document.getElementById('socials-twitter').value}\n`;
          }
          
          // LinkedIn
          if (document.getElementById('socials-linkedin-toggle').checked && document.getElementById('socials-linkedin').value) {
            const linkedinEmoji = includeEmojis ? '💼 ' : '';
            output += `➤ [LINKEDIN] ${linkedinEmoji}${document.getElementById('socials-linkedin').value}\n`;
          }
          
          // Reddit
          if (document.getElementById('socials-reddit-toggle').checked && document.getElementById('socials-reddit').value) {
            const redditEmoji = includeEmojis ? '👽 ' : '';
            output += `➤ [REDDIT] ${redditEmoji}${document.getElementById('socials-reddit').value}\n`;
          }
          
          // Discord
          if (document.getElementById('socials-discord-toggle').checked && document.getElementById('socials-discord').value) {
            const discordEmoji = includeEmojis ? '🎮 ' : '';
            output += `➤ [DISCORD] ${discordEmoji}${document.getElementById('socials-discord').value}\n`;
          }
          
          // YouTube
          if (document.getElementById('socials-youtube-toggle').checked && document.getElementById('socials-youtube').value) {
            const ytEmoji = includeEmojis ? '▶️ ' : '';
            output += `➤ [YOUTUBE] ${ytEmoji}${document.getElementById('socials-youtube').value}\n`;
          }
          
          // Twitch
          if (document.getElementById('socials-twitch-toggle').checked && document.getElementById('socials-twitch').value) {
            const twitchEmoji = includeEmojis ? '🎥 ' : '';
            output += `➤ [TWITCH] ${twitchEmoji}${document.getElementById('socials-twitch').value}\n`;
          }
          
          // Steam
          if (document.getElementById('socials-steam-toggle').checked && document.getElementById('socials-steam').value) {
            const steamEmoji = includeEmojis ? '🎮 ' : '';
            output += `➤ [STEAM] ${steamEmoji}${document.getElementById('socials-steam').value}\n`;
          }
          
          // TikTok
          if (document.getElementById('socials-tiktok-toggle').checked && document.getElementById('socials-tiktok').value) {
            const tiktokEmoji = includeEmojis ? '🎵 ' : '';
            output += `➤ [TIKTOK] ${tiktokEmoji}${document.getElementById('socials-tiktok').value}\n`;
          }
          
          // Snapchat
          if (document.getElementById('socials-snapchat-toggle').checked && document.getElementById('socials-snapchat').value) {
            const snapEmoji = includeEmojis ? '👻 ' : '';
            output += `➤ [SNAPCHAT] ${snapEmoji}${document.getElementById('socials-snapchat').value}\n`;
          }
          
          // Additional Socials
          if (document.getElementById('socials-additional-toggle').checked && document.getElementById('socials-additional').value) {
            const otherEmoji = includeEmojis ? '🔗 ' : '';
            output += `➤ [ADDITIONAL SOCIALS] ${otherEmoji}\n`;
            output += `   ${document.getElementById('socials-additional').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          output += '\n';
        }
        } catch (err) {
          console.error('Error processing socials section:', err);
        }
        
        // Data Leaks Section
        try {
          const leaksEmoji = includeEmojis ? '🔓 ' : '';
          const leaksSection = document.getElementById('section-leaks');
          if (leaksSection && leaksSection.classList.contains('active')) {
          if (styleFormat === 'ascii' || styleFormat === 'modern') {
            output += `██████████ ${leaksEmoji}DATA LEAKS ██████████\n\n`;
          } else if (styleFormat === 'minimal') {
            output += `## ${leaksEmoji}DATA LEAKS\n\n`;
          } else if (styleFormat === 'fancy') {
            output += `✧･ﾟ: *✧･ﾟ:* ${leaksEmoji}DATA LEAKS *:･ﾟ✧*:･ﾟ✧\n\n`;
          }
          
          // Passwords
          if (document.getElementById('leaks-passwords-toggle').checked && document.getElementById('leaks-passwords').value) {
            const passEmoji = includeEmojis ? '🔑 ' : '';
            output += `➤ [PASSWORDS] ${passEmoji}\n`;
            output += `   ${document.getElementById('leaks-passwords').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Data Breaches
          if (document.getElementById('leaks-breaches-toggle').checked && document.getElementById('leaks-breaches').value) {
            const breachEmoji = includeEmojis ? '⚠️ ' : '';
            output += `➤ [DATA BREACHES] ${breachEmoji}\n`;
            output += `   ${document.getElementById('leaks-breaches').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          // Exposed Information
          if (document.getElementById('leaks-exposed-toggle').checked && document.getElementById('leaks-exposed').value) {
            const exposedEmoji = includeEmojis ? '📄 ' : '';
            output += `➤ [EXPOSED INFORMATION] ${exposedEmoji}\n`;
            output += `   ${document.getElementById('leaks-exposed').value.replace(/\n/g, '\n   ')}\n`;
          }
          
          output += '\n';
        }
        } catch (err) {
          console.error('Error processing leaks section:', err);
        }
        
        // Footer based on format
        try {
          if (styleFormat === 'ascii') {
          output += '\n╔══════════════════════════════════════════╗\n';
          output += '║        GENERATED WITH 7FX8\'S TOOL        ║\n';
          output += '╚══════════════════════════════════════════╝';
        } else if (styleFormat === 'modern') {
          output += '\n┌─────────────────────────────────────────┐\n';
          output += '│        GENERATED WITH 7FX8\'S TOOL        │\n';
          output += '└─────────────────────────────────────────┘';
        } else if (styleFormat === 'minimal') {
          output += '\n----------------------------------------\n';
          output += 'GENERATED WITH 7FX8\'S TOOL';
        } else if (styleFormat === 'fancy') {
          output += '\n•❅──────✧❅✦❅✧──────❅•\n';
          output += '   GENERATED WITH 7FX8\'S TOOL\n';
          output += '•❅──────✧❅✦❅✧──────❅•';
        }
        } catch (err) {
          console.error('Error processing footer:', err);
        }
        
        return output;
        
      } catch(error) {
          console.error("Error in generateFormattedOutput:", error);
          console.error("Error stack:", error.stack);
          
          // Check what specific element or step failed
          try {
            const outputElement = document.getElementById('output-format');
            if (outputElement) {
              outputElement.textContent = "Error generating output. Please check the console for details.\n\n" + error.message;
              outputElement.style.display = 'block';
              outputElement.style.color = 'red';
            }
          } catch (displayErr) {
            console.error("Error displaying error message:", displayErr);
          }
          
          // Try to show a toast, but don't fail if that errors too
          try {
            if (typeof showToast === 'function') {
              showToast('Error', `Generation failed: ${error.message}`, 'error');
            }
          } catch (toastErr) {
            console.error("Error showing toast:", toastErr);
          }
          
          return "Error generating output. Please check the console for details.";
        }
      }
      
      // Function to show toast notifications
      function showToast(title, message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        
        // Create toast element
        const toast = document.createElement('div');
        toast.classList.add('toast', type);
        
        // Set icon based on type
        let iconClass = 'fas fa-check-circle';
        if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';
        if (type === 'error') iconClass = 'fas fa-times-circle';
        
        toast.innerHTML = `
          <div class="toast-icon"><i class="${iconClass}"></i></div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
            <div class="progress-bar"><div class="progress"></div></div>
          </div>
          <button class="toast-close"><i class="fas fa-times"></i></button>
        `;
        
        // Add to container
        toastContainer.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
          toast.style.opacity = '1';
          toast.style.transform = 'translateX(0)';
        }, 10);
        
        // Close button functionality
        toast.querySelector('.toast-close').addEventListener('click', () => {
          closeToast(toast);
        });
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          closeToast(toast);
        }, 5000);
      }
      
      function closeToast(toast) {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
      
      // Function to download output as text file - completely rewritten for reliability
      function downloadOutput() {
        // Simple direct approach for downloading text
        var downloadText = function() {
          // Get the output element and text
          var outputElement = document.getElementById('output-format');
          if (!outputElement) {
            alert("Cannot find the output area!");
            return false;
          }
          
          var textToDownload = outputElement.textContent || outputElement.innerText;
          
          if (!textToDownload || !textToDownload.trim()) {
            alert("No content to download!");
            return false;
          }
          
          // Get name from basic info if available
          var nameField = document.getElementById('basic-name');
          var fileName = 'dox.txt'; // Default filename
          
          if (nameField && nameField.value && nameField.value.trim()) {
            // Clean the name to be filename safe
            var cleanName = nameField.value.trim()
              .toLowerCase()
              .replace(/[^a-z0-9]/gi, '_') // Replace non-alphanumeric chars with underscore
              .replace(/_+/g, '_')         // Replace multiple underscores with single
              .replace(/^_|_$/g, '');      // Remove leading/trailing underscores
              
            if (cleanName) {
              fileName = cleanName + '_dox.txt';
            }
          }
          
          // Create a blob with the text content
          var blob = new Blob([textToDownload], {type: 'text/plain;charset=utf-8'});
          
          // Create download link
          var downloadLink = document.createElement('a');
          
          // Support for IE & Edge
          if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            window.navigator.msSaveOrOpenBlob(blob, fileName);
            alert("Download started! Check your downloads folder for: " + fileName);
            return true;
          }
          
          // For other browsers
          var url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.download = fileName;
          
          // Make link invisible
          downloadLink.style.display = 'none';
          document.body.appendChild(downloadLink);
          
          // Trigger download
          downloadLink.click();
          
          // Clean up
          setTimeout(function() {
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(url);
          }, 100);
          
          alert("Download started! File saved as: " + fileName);
          return true;
        };
        
        // Execute the download function
        downloadText();
      }
      }
      
      // Function to save form state to localStorage
      function saveDraft() {
        const formData = {};
        document.querySelectorAll('input[type="text"], textarea').forEach(input => {
          formData[input.id] = input.value;
        });
        
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          formData[checkbox.id] = checkbox.checked;
        });

  // Persist selected template if set
  if (window._currentTemplate) formData._template = window._currentTemplate;
        
        localStorage.setItem('doxFormatterDraft', JSON.stringify(formData));
      }
      
      // Function to load draft from localStorage
      function loadDraft() {
        const savedData = localStorage.getItem('doxFormatterDraft');
        if (savedData) {
          const formData = JSON.parse(savedData);
          
          Object.keys(formData).forEach(id => {
            const element = document.getElementById(id);
            if (element) {
              if (element.type === 'checkbox') {
                element.checked = formData[id];
              } else {
                element.value = formData[id];
              }
            }
          });

          // If a template was saved, re-apply it so field visibility matches
          if (formData._template) {
            window._currentTemplate = formData._template;
            applyTemplate(formData._template);
          }
          
          // Update disabled state for inputs (only for *-toggle checkboxes)
          document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            if (!checkbox.id || !checkbox.id.endsWith('-toggle')) return;
            const fieldId = checkbox.id.replace(/-toggle$/, '');
            const field = document.getElementById(fieldId);
            if (field) {
              field.disabled = !checkbox.checked;
            }
          });
          
          showToast('Draft Loaded', 'Previously saved data has been restored', 'success');
        }
      }
      
      // Function to apply a template
      function applyTemplate(templateType) {
        // Templates metadata: list fields to show and the ASCII content (placeholders wrapped in {{}})
        const TEMPLATES = {
          basic: {
            fields: ['basic-name', 'basic-pseudonyms', 'basic-reason'],
            ascii: null
          },
          detailed: {
            fields: ['basic-name', 'basic-pseudonyms', 'basic-reason', 'personal-email', 'personal-phone', 'socials-instagram', 'socials-twitter'],
            ascii: null
          },
          minimal: {
            fields: ['basic-name'],
            ascii: null
          },
          oswald: {
            fields: ['basic-name', 'basic-pseudonyms', 'basic-reason', 'personal-email', 'personal-phone', 'personal-ssn'],
            ascii: null
          },
          'oswald-ocean': {
            fields: ['basic-picture','basic-name','basic-pseudonyms','basic-reason','personal-citizenship','personal-isp','personal-address','personal-phone',
                   'family-mother-name','family-mother-dob','family-mother-location','family-mother-phone','family-mother-email','family-mother-occupation',
                   'family-father-name','family-father-dob','family-father-location','family-father-phone','family-father-email','family-father-occupation',
                   'family-sibling1-name','family-sibling1-dob','family-sibling1-location',
                   'family-spouse-name','family-spouse-dob','family-marriage-date',
                   'family-child1-name','family-child1-dob',
                   'education-elementary-name','education-elementary-years','education-elementary-location',
                   'education-middle-name','education-middle-years','education-middle-location',
                   'education-hs-name','education-hs-years','education-hs-location','education-hs-gpa',
                   'education-college-name','education-college-degree','education-college-years','education-college-location',
                   'education-grad-name','education-grad-degree',
                   'education-certifications','education-skills',
                   'socials-discord','personal-email','notes'],
            ascii: null
          },
          'oswald-long': {
            fields: ['basic-name', 'basic-pseudonyms', 'basic-reason', 'personal-email', 'family-mother-name', 'family-father-name', 'education-hs-name'],
            ascii: null
          },
          barcode: {
            fields: ['basic-name'],
            ascii: null
          }
        };

  // Clear existing data only for fields not present in the chosen template to avoid losing input
  const template = TEMPLATES[templateType] || { fields: [] };
  window._currentTemplate = templateType;

        // Check all toggle checkboxes by default and show all field groups
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          if (!checkbox.id || !checkbox.id.endsWith('-toggle')) return;
          checkbox.checked = true; // Check all by default
          
          // Also enable any associated input fields
          const fieldId = checkbox.id.replace(/-toggle$/, '');
          const field = document.getElementById(fieldId);
          if (field) {
            field.disabled = false;
          }
          
          // Show the toggle row/label
          const toggleRow = checkbox.closest('.field-toggle');
          if (toggleRow) toggleRow.classList.remove('template-hidden');
        });

        // Show all field groups by default
        document.querySelectorAll('.field-group, .family-member, .education-level').forEach(group => {
          group.classList.remove('template-hidden');
        });

        // Show/enable only the fields declared in the template.metadata
        template.fields.forEach(fieldId => {
          const toggle = document.getElementById(fieldId + '-toggle');
          const field = document.getElementById(fieldId);
          // Show toggle row
          if (toggle) {
            const toggleRow = toggle.closest('.field-toggle');
            if (toggleRow) toggleRow.classList.remove('template-hidden');
            toggle.checked = true;
          }
          // Show containing field-group and enable input
          if (field) {
            const fg = field.closest('.field-group') || field.closest('.family-member') || field.closest('.education-level');
            if (fg) fg.classList.remove('template-hidden');
            field.disabled = false;
          }
        });

        // If the template includes an ascii content, store it on the currently selected template for generation
        // If ascii is null, attempt to load the template body from a hidden <script type="text/plain" data-template="..."> block
        let asciiBody = template.ascii || null;
        if (!asciiBody) {
          try {
            const domScript = document.querySelector(`script[type="text/plain"][data-template="${templateType}"]`);
            if (domScript) asciiBody = domScript.textContent || null;
          } catch (e) {
            asciiBody = null;
          }
        }
        window._selectedAsciiTemplate = asciiBody;

        // Visually ensure related sections are expanded so users see the visible fields
        document.querySelectorAll('.section').forEach(section => {
          const hasVisible = Array.from(section.querySelectorAll('input[type="text"], textarea')).some(el => !el.disabled && el.id);
          if (hasVisible) section.classList.add('active');
        });
      }
      
      // Function to populate emoji picker
      function populateEmojiPicker() {
        const emojiPicker = document.getElementById('emoji-picker');
        const commonEmojis = [
          '😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂', '🙂', '🙃',
          '😉', '😊', '😇', '😍', '🥰', '😘', '😗', '😚', '😙', '😋',
          '😛', '😜', '😝', '🤑', '🤗', '🤭', '🤫', '🤔', '🤐', '🤨',
          '😐', '😑', '😶', '😏', '😒', '🙄', '😬', '🤥', '😌', '😔',
          '😪', '🤤', '😴', '😷', '🤒', '🤕', '🤢', '🤮', '🤧', '🥵'
        ];
        
        commonEmojis.forEach(emoji => {
          const emojiBtn = document.createElement('div');
          emojiBtn.classList.add('emoji-btn');
          emojiBtn.textContent = emoji;
          emojiBtn.addEventListener('click', () => {
            // Find active input or textarea and insert emoji
            const activeElement = document.activeElement;
            if (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA') {
              const start = activeElement.selectionStart;
              const end = activeElement.selectionEnd;
              const value = activeElement.value;
              activeElement.value = value.substring(0, start) + emoji + value.substring(end);
              activeElement.selectionStart = activeElement.selectionEnd = start + emoji.length;
              activeElement.focus();
            }
            
            // Close emoji picker
            document.getElementById('emoji-picker').style.display = 'none';
          });
          emojiPicker.appendChild(emojiBtn);
        });
      }
      
      // Auto-apply default template
      applyTemplate('oswald-main');
      
      // Initialize: expand the first section by default and collapse others
      document.querySelectorAll('.section').forEach((section, index) => {
        const content = section.querySelector('.section-content');
        
        // Check all toggle checkboxes in this section by default
        section.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          if (checkbox.id && checkbox.id.endsWith('-toggle')) {
            checkbox.checked = true;
            
            // Also enable any associated input fields
            const fieldId = checkbox.id.replace(/-toggle$/, '');
            const field = document.getElementById(fieldId);
            if (field) {
              field.disabled = false;
            }
          }
        });
        
        if (index === 0) {
          // Open the first section by default for better UX
          section.classList.add('active');
          if (content) {
            content.style.maxHeight = '10000px';
            content.style.opacity = '1';
            content.style.padding = '18px 20px';
            content.style.display = 'block';
            content.style.overflow = 'visible';
          }
          console.log('Default section opened:', section.id);
        } else {
          section.classList.remove('active');
          if (content) {
            content.style.maxHeight = '0';
            content.style.opacity = '0';
            content.style.padding = '0';
            content.style.overflow = 'hidden';
          }
        }
      });
      
      // Define a function to toggle section visibility
      function toggleSection(section, forceState = null) {
        if (!section) return;
        
        // Get current state
        const isActive = section.classList.contains('active');
        const content = section.querySelector('.section-content');
        
        // Determine target state - either forced or toggled
        const shouldBeActive = (forceState !== null) ? forceState : !isActive;
        
        // Apply state
        if (shouldBeActive) {
          section.classList.add('active');
          if (content) {
            content.style.display = 'block';
            content.style.maxHeight = '10000px';
            content.style.opacity = '1';
            content.style.padding = '18px 20px';
            content.style.overflow = 'visible';
          }
        } else {
          section.classList.remove('active');
          if (content) {
            content.style.maxHeight = '0';
            content.style.opacity = '0';
            content.style.padding = '0';
            content.style.overflow = 'hidden';
          }
        }
        
        console.log('Section', section.id, shouldBeActive ? 'opened' : 'closed');
      }
      
      // Ensure all section headers have click event handlers
      document.querySelectorAll('.section-header').forEach(function(header) {
        header.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Get the section and toggle it
          const section = this.closest('.section');
          toggleSection(section);
        };
      });
      
      // EMERGENCY FIX: Add direct onclick attributes to each section header
      // This bypasses all other JavaScript to ensure sections can be toggled
      document.querySelectorAll('.section-header').forEach(header => {
        header.setAttribute('onclick', 'toggleSectionDirect(this.parentNode);');
      });
      
      // Create a global direct toggle function
      window.toggleSectionDirect = function(section) {
        if (!section) return;
        section.classList.toggle('active');
        
        const content = section.querySelector('.section-content');
        if (!content) return;
        
        if (section.classList.contains('active')) {
          content.style.display = 'block';
          content.style.maxHeight = 'none';
          content.style.height = 'auto';
          content.style.opacity = '1';
          content.style.padding = '18px 20px';
          content.style.overflow = 'visible';
        } else {
          content.style.display = 'none';
          content.style.maxHeight = '0';
          content.style.height = '0';
          content.style.opacity = '0';
          content.style.padding = '0';
        }
      };
      
      // Function to check all checkboxes and expand all sections
      function forceCheckAllAndExpandSections() {
        console.log("Force checking all checkboxes and expanding all sections");
        
        try {
          // Reset all section header click handlers
          document.querySelectorAll('.section-header').forEach(header => {
            try {
              // Remove all click events by cloning
              const newHeader = header.cloneNode(true);
              if (header.parentNode) {
                header.parentNode.replaceChild(newHeader, header);
                
                // Add new direct click handler
                newHeader.onclick = function() {
                  if (typeof toggleSectionDirect === 'function') {
                    toggleSectionDirect(this.parentNode);
                  } else {
                    console.error('toggleSectionDirect function not found');
                  }
                  return false;
                };
              }
            } catch (err) {
              console.error('Error resetting header click handlers:', err);
            }
          });
          
          // Check all checkboxes
          document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            try {
              checkbox.checked = true;
              console.log(`Checked checkbox: ${checkbox.id || 'unnamed'}`);
              
              // Enable associated input if it's a toggle checkbox
              if (checkbox.id && checkbox.id.endsWith('-toggle')) {
                const fieldId = checkbox.id.replace(/-toggle$/, '');
                const field = document.getElementById(fieldId);
                if (field) {
                  field.disabled = false;
                }
                
                // Make sure parent elements are visible
                let parent = checkbox.parentElement;
                while (parent) {
                  if (parent.classList && parent.classList.contains('template-hidden')) {
                    parent.classList.remove('template-hidden');
                  }
                  parent = parent.parentElement;
                }
              }
            } catch (err) {
              console.error('Error checking checkbox:', err);
            }
          });
          
          // Expand all sections
          document.querySelectorAll('.section').forEach(section => {
            try {
              section.classList.add('active');
              const content = section.querySelector('.section-content');
              if (content) {
                content.style.display = 'block';
                content.style.height = 'auto';
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '18px 20px';
                content.style.overflow = 'visible';
              }
            } catch (err) {
              console.error('Error expanding section:', err);
            }
          });
        } catch (err) {
          console.error('Error in forceCheckAllAndExpandSections:', err);
        }
      }
      
      // Create a fixed button in the corner
      const fixButton = document.createElement('button');
      fixButton.innerHTML = 'Fix Sections & Check All';
      fixButton.style.position = 'fixed';
      fixButton.style.bottom = '20px';
      fixButton.style.right = '20px';
      fixButton.style.zIndex = '1000';
      fixButton.style.padding = '10px 15px';
      fixButton.style.backgroundColor = '#4CAF50';
      fixButton.style.color = 'white';
      fixButton.style.border = 'none';
      fixButton.style.borderRadius = '5px';
      fixButton.style.cursor = 'pointer';
      fixButton.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
      
      fixButton.addEventListener('click', function() {
        forceCheckAllAndExpandSections();
        alert('All sections expanded and all checkboxes checked!');
      });
      
      document.body.appendChild(fixButton);
      
      // Run the fix function immediately and also with a delay to ensure it works
      forceCheckAllAndExpandSections();
      setTimeout(forceCheckAllAndExpandSections, 500);
      
      // Also run the fix whenever the user clicks anywhere on the document (with debounce)
      let clickTimeout;
      document.addEventListener('click', function() {
        clearTimeout(clickTimeout);
        clickTimeout = setTimeout(forceCheckAllAndExpandSections, 200);
      });
    });
    
    // Add debug generate button event listener
    document.getElementById('debug-generate-btn').addEventListener('click', function() {
      console.clear();
      console.log('Debug Generate button clicked - Starting simplified generation');
      
      // Show loading state
      this.innerHTML = '<span class="spinner"></span> Debugging...';
      this.disabled = true;
      
      setTimeout(() => {
        try {
          // Force check all checkboxes first
          document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = true;
            
            // Enable associated input if it's a toggle checkbox
            if (checkbox.id && checkbox.id.endsWith('-toggle')) {
              const fieldId = checkbox.id.replace(/-toggle$/, '');
              const field = document.getElementById(fieldId);
              if (field) {
                field.disabled = false;
              }
            }
          });
          
          // Force expand all sections
          document.querySelectorAll('.section').forEach(section => {
            section.classList.add('active');
            const content = section.querySelector('.section-content');
            if (content) {
              content.style.display = 'block';
              content.style.height = 'auto';
              content.style.maxHeight = 'none';
              content.style.opacity = '1';
              content.style.padding = '18px 20px';
              content.style.overflow = 'visible';
            }
          });
          
          // Re-establish section toggle functionality
          document.querySelectorAll('.section-header').forEach(header => {
            // Clone the header to remove existing event listeners
            const newHeader = header.cloneNode(true);
            if (header.parentNode) {
              header.parentNode.replaceChild(newHeader, header);
              
              // Add back the click handler
              newHeader.onclick = function() {
                const section = this.parentNode;
                section.classList.toggle('active');
                
                const content = section.querySelector('.section-content');
                if (!content) return;
                
                if (section.classList.contains('active')) {
                  content.style.display = 'block';
                  content.style.height = 'auto';
                  content.style.maxHeight = 'none';
                  content.style.opacity = '1';
                  content.style.padding = '18px 20px';
                  content.style.overflow = 'visible';
                } else {
                  content.style.display = 'none';
                  content.style.maxHeight = '0';
                  content.style.height = '0';
                  content.style.opacity = '0';
                  content.style.padding = '0';
                }
              };
            }
          });
          
          // Create a simple output manually without using generateFormattedOutput
          let debugOutput = "=== DEBUG OUTPUT ===\n\n";
          
          // Gather some form values directly
          const sections = document.querySelectorAll('.section');
          sections.forEach(section => {
            const sectionId = section.id;
            debugOutput += `SECTION: ${sectionId}\n`;
            
            // Get inputs and values
            const inputs = section.querySelectorAll('input[type="text"], textarea');
            inputs.forEach(input => {
              if (input.id && input.value) {
                debugOutput += `${input.id}: ${input.value}\n`;
              }
            });
            
            debugOutput += '\n';
          });
          
          // Set the output directly
          const outputElement = document.getElementById('output-format');
          if (outputElement) {
            outputElement.textContent = debugOutput;
            outputElement.style.display = 'block';
            outputElement.scrollIntoView({ behavior: 'smooth' });
          }
          
          // Show success message
          alert('Debug generation completed. Check the output area and console.');
        } catch (error) {
          console.error('Debug generation error:', error);
          alert('Error during debug generation. See console for details.');
        }
        
        // Reset button state
        this.innerHTML = '<i class="fas fa-bug"></i> Debug Generate';
        this.disabled = false;
      }, 500);
    });
    
    // Add one more check outside the DOMContentLoaded event to catch late-loaded elements
    window.onload = function() {
      setTimeout(function() {
        console.log("Window loaded - checking all checkboxes again");
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          checkbox.checked = true;
          
          if (checkbox.id && checkbox.id.endsWith('-toggle')) {
            const fieldId = checkbox.id.replace(/-toggle$/, '');
            const field = document.getElementById(fieldId);
            if (field) field.disabled = false;
          }
          
          // Also expand all sections again for good measure
          document.querySelectorAll('.section').forEach(section => {
            section.classList.add('active');
            const content = section.querySelector('.section-content');
            if (content) {
              content.style.display = 'block';
              content.style.height = 'auto';
              content.style.maxHeight = 'none';
              content.style.opacity = '1';
              content.style.padding = '18px 20px';
              content.style.overflow = 'visible';
            }
          });
        });
      }, 500);
    };
  </script>

  <!-- Hidden template bodies (plain text) to avoid embedding large ASCII in JS literals -->
  <script type="text/plain" data-template="oswald">
──────────────────────────────────────────────────────────
OSWALD TEMPLATE
Picture: {{basic-picture}}
Name: {{basic-name}}
Pseudonyms: {{basic-pseudonyms}}
Reason: {{basic-reason}}
Age: {{basic-age}}
Date of Birth: {{basic-dob}}
Place of Birth: {{basic-birthplace}}
Current Location: {{basic-location}}
Race / Ethnicity: {{basic-race}}
Sexual Orientation: {{basic-sexual}}
Political Affiliation: {{basic-political}}
Native Language: {{basic-language}}
Religion: {{basic-religion}}
Gender: {{basic-gender}}
Weight: {{basic-weight}}
Height: {{basic-height}}
Additional Info: {{basic-additional-info}}
──────────────────────────────────────────────────────────
  </script>

  <script type="text/plain" data-template="oswald-main">
                                                        BASIC INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                                        ➤ Name: {{basic-name}}
                                                          ➣ Pseudonyms: {{basic-pseudonyms}}
                                                          ➣ Reason: {{basic-reason}}
                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Age: {{basic-age}}
                                                        ➤ Face: {{basic-picture}}
                                                        ➤ [DOB] Date of Birth: {{basic-dob}}
                                                        ➤ Birthplace: {{basic-birthplace}}
                                                        ➤ Location: {{basic-location}}
                                                        ➤ Race: {{basic-race}}
                                                        ➤ Sexual Orientation: {{basic-sexual}}
                                                        ➤ Political Affiliation: {{basic-political}}
                                                        ➤ Native Language: {{basic-language}}
                                                        ➤ Religion: {{basic-religion}}
                                                        ➤ Job: {{basic-additional-info}}
                                                        ➤ High school: {{education-hs-name-with-toggle}} (Class of {{education-hs-end-with-toggle}})
                                                        ➤ College: {{education-college-degree-with-toggle}} at {{education-college-name-with-toggle}}
                                                        ➤ Info: {{notes}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                          ➣ Gender: {{basic-gender}}
                                                          ➣ Weight: {{basic-weight}}
                                                          ➣ Height: {{basic-height}}
                                                          ➣ Notes: {{notes}}
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        PERSONAL INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                                        ➤ Country of Citizenship: {{personal-citizenship}}

                                                        ➤ ⚠️ [SSN] Social Security Number: "{{personal-ssn}}"
                                                        ➤ ⚠️ [DLN] Driver License: "{{personal-dln}}"

                                                        ➤ [ISP] Internet Service Provider: {{personal-isp}}
                                                        ➤ Area Code: {{personal-area}}
                                                        ➤ Emails: {{personal-email}}
                                                        ➤ Passwords: {{leaks-passwords}}
                                                        ➤ Mobile Phone Number: {{personal-phone}}
                                                        ➤ Current Address: {{personal-address}}
                                                          ➣ Previous Address: {{personal-prev-address}}
                                                        ➤ Postal Code: {{personal-postal}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗

                                                          ➣ Static/Dynamic Assignment: {{personal-static-dynamic}}
                                                          ➣ Previous Internet Protocol IPV4: {{personal-ip}}
                                                          ➣ Timezone: {{personal-timezone}}
                                                          ➣ IP: {{personal-ip}}

                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝
                                                        FAMILY INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Mother
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Mother Name: {{family-mother-name}}
                                                          ➣ Picture: {{family-mother-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-mother-dob}}
                                                          ➣ Age: {{family-mother-age}}
                                                          ➣ Current Address: {{family-mother-address}}
                                                          ➣ Mobile Phone Number: {{family-mother-emails}}
                                                          ➣ Emails: {{family-mother-emails}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Father
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Father Name: {{family-father-name}}
                                                          ➣ Picture: {{family-father-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-father-dob}}
                                                          ➣ Age: {{family-father-age}}
                                                          ➣ Current Address: {{family-father-address}}
                                                          ➣ Mobile Phone Number: {{family-father-emails}}
                                                          ➣ Emails: {{family-father-emails}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Grandpa
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Grandpa Name: {{family-grandpa-name}}
                                                          ➣ Picture: {{family-grandpa-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-grandpa-dob}}
                                                          ➣ Age: {{family-grandpa-age}}
                                                          ➣ Current Address: {{family-grandpa-address}}
                                                          ➣ Mobile Phone Number: {{family-grandpa-emails}}
                                                          ➣ Emails: {{family-grandpa-emails}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Grandma
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Grandma Name: {{family-grandma-name}}
                                                          ➣ Picture: {{family-grandma-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-grandma-dob}}
                                                          ➣ Age: {{family-grandma-age}}
                                                          ➣ Current Address: {{family-grandma-address}}
                                                          ➣ Mobile Phone Number: {{family-grandma-emails}}
                                                          ➣ Emails: {{family-grandma-emails}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Sister
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Sister Name: {{family-sister-name}}
                                                          ➣ Picture: {{family-sister-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-sister-dob}}
                                                          ➣ Age: {{family-sister-age}}
                                                          ➣ Current Address: {{family-sister-address}}
                                                          ➣ Mobile Phone Number: {{family-sister-phone}}
                                                          ➣ Emails: {{family-sister-emails}}
                                                          ➣ Additional: {{family-sister-additional}}

                                    ╔──────────────────────────────────────────────────────────────────────────────๑◥◣◆◢◤๑──────────────────────────────────────────────────────────────────────────────╗
                                                        Brother
                                    ╚──────────────────────────────────────────────────────────────────────────────๑◢◤◆◥◣๑──────────────────────────────────────────────────────────────────────────────╝

                                                        ➤ Brother Name: {{family-brother-name}}
                                                          ➣ Picture: {{family-brother-picture}}
                                                          ➣ [DOB] Date of Birth: {{family-brother-dob}}
                                                          ➣ Age: {{family-brother-age}}
                                                          ➣ Current Address: {{family-brother-address}}
                                                          ➣ Mobile Phone Number: {{family-brother-phone}}
                                                          ➣ Emails: {{family-brother-emails}}
                                                          ➣ Additional: {{family-brother-additional}}
                                                          ➣ Siblings: {{family-siblings}}

                                                        EDUCATION INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                                        ➤ Name: {{education-hs-name}}
                                                        ➤ Location: {{education-hs-location}}
                                                        ➤ Start: {{education-hs-start}}
                                                        ➤ End: {{education-hs-end}}
                                                        ➤ Degree: {{education-hs-degree}}

                                                        ➤ Name: {{education-college-name}}
                                                        ➤ Location: {{education-college-location}}
                                                        ➤ Start: {{education-college-start}}
                                                        ➤ End: {{education-college-end}}
                                                        ➤ Degree: {{education-college-degree}}

                                                        SOCIALS INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                                        ➤ Instagram: {{socials-instagram}}
                                                        ➤ Facebook: {{socials-facebook}}
                                                        ➤ Twitter: {{socials-twitter}}
                                                        ➤ LinkedIn: {{socials-linkedin}}
                                                        ➤ Reddit: {{socials-reddit}}
                                                        ➤ TikTok: {{socials-tiktok}}
                                                        ➤ Snapchat: {{socials-snapchat}}
                                                        ➤ YouTube: {{socials-youtube}}
                                                        ➤ Kick: {{socials-kick}}
                                                        ➤ Discord: {{socials-discord}}
                                                        ➤ Other: {{socials-other}}

                                                        LEAKS INFORMATION
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

                                                        ➤ Info: {{leaks-info}}
                                                        ➤ Source: {{leaks-source}}
                                                        ➤ Date: {{leaks-date}}
                                                        ➤ Passwords: {{leaks-passwords}}
                                                        ➤ Databases: {{leaks-databases}}
                                                        ➤ Credit: {{leaks-credit}}

                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
                                                       [X] Made with 7fx8's Dox Formatter
                                    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

  </script>
  
  <!-- Bottom Buttons -->
  <div style="text-align: center; margin: 30px 0; padding: 20px;">
    <button id="debug-generate-btn" style="padding: 15px 30px; font-size: 18px; background-color: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); margin-right: 15px;">
      <i class="fas fa-bug" style="margin-right: 10px;"></i>Debug Generate
    </button>
    <button id="bottom-check-all-btn" style="padding: 15px 30px; font-size: 18px; background-color: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); margin-right: 15px;">
      <i class="fas fa-check-square" style="margin-right: 10px;"></i>Check All Boxes
    </button>
    
    <button id="fill-test-btn" style="padding: 15px 30px; font-size: 18px; background-color: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
      <i class="fas fa-fill-drip" style="margin-right: 10px;"></i>Fill All with "Test"
    </button>
  </div>
  
  <!-- Fixed Buttons Implementation -->
  <script>
    // Wait for the page to be fully loaded
    window.addEventListener('load', function() {
      console.log('Fixed buttons script loaded');
      
      // Function to show toast notifications
      function fixedShowToast(title, message, type) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
          console.error('Toast container not found');
          alert(`${title}: ${message}`);
          return;
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.classList.add('toast', type || 'success');
        
        // Set icon based on type
        let iconClass = 'fas fa-check-circle';
        if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';
        if (type === 'error') iconClass = 'fas fa-times-circle';
        
        toast.innerHTML = `
          <div class="toast-icon"><i class="${iconClass}"></i></div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
            <div class="progress-bar"><div class="progress"></div></div>
          </div>
          <button class="toast-close"><i class="fas fa-times"></i></button>
        `;
        
        // Add to container
        toastContainer.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
          toast.style.opacity = '1';
          toast.style.transform = 'translateX(0)';
        }, 10);
        
        // Close button functionality
        toast.querySelector('.toast-close').addEventListener('click', () => {
          fixedCloseToast(toast);
        });
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          fixedCloseToast(toast);
        }, 5000);
      }
      
      // Function to close toast
      function fixedCloseToast(toast) {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }
      
      // Function to expand all sections and prepare checkboxes for generation
      function fixedExpandAllAndCheckAll() {
        console.log("Fixed: Expanding all sections and preparing fields");
        
        // Enable/disable fields based on checkbox state
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          // Only set disabled state based on current checkbox state
          if (checkbox.id && checkbox.id.endsWith('-toggle')) {
            const fieldId = checkbox.id.replace(/-toggle$/, '');
            const field = document.getElementById(fieldId);
            if (field) {
              field.disabled = !checkbox.checked;
            }
          }
        });
        
        // Expand all sections
        document.querySelectorAll('.section').forEach(section => {
          section.classList.add('active');
          const content = section.querySelector('.section-content');
          if (content) {
            content.style.display = 'block';
            content.style.height = 'auto';
            content.style.maxHeight = 'none';
            content.style.opacity = '1';
            content.style.padding = '18px 20px';
            content.style.overflow = 'visible';
          }
        });
        
        // Re-establish section toggle functionality
        document.querySelectorAll('.section-header').forEach(header => {
          // Clone the header to remove existing event listeners
          const newHeader = header.cloneNode(true);
          if (header.parentNode) {
            header.parentNode.replaceChild(newHeader, header);
            
            // Add back the click handler
            newHeader.onclick = function() {
              const section = this.parentNode;
              section.classList.toggle('active');
              
              const content = section.querySelector('.section-content');
              if (!content) return;
              
              if (section.classList.contains('active')) {
                content.style.display = 'block';
                content.style.height = 'auto';
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '18px 20px';
                content.style.overflow = 'visible';
              } else {
                content.style.display = 'none';
                content.style.maxHeight = '0';
                content.style.height = '0';
                content.style.opacity = '0';
                content.style.padding = '0';
              }
            };
          }
        });
      }
      
      // GENERATE FORMAT BUTTON - COMPLETELY NEW IMPLEMENTATION
      const generateBtn = document.getElementById('generate-btn');
      if (generateBtn) {
        // Remove any existing event listeners by cloning and replacing
        const newGenerateBtn = generateBtn.cloneNode(true);
        generateBtn.parentNode.replaceChild(newGenerateBtn, generateBtn);
        
        newGenerateBtn.addEventListener('click', function() {
          console.log('Fixed Generate button clicked');
          
          // Show loading state
          this.innerHTML = '<span class="spinner"></span> Generating...';
          this.disabled = true;
          
          setTimeout(() => {
            try {
              // Make sure all sections are expanded and fields are properly enabled/disabled
              fixedExpandAllAndCheckAll();
              
              // Load the oswald-main template
              const templateType = "oswald-main";
              let asciiBody = "";
              
              // Get template content from script tag
              const domScript = document.querySelector(`script[type="text/plain"][data-template="${templateType}"]`);
              if (domScript) {
                asciiBody = domScript.textContent;
              } else {
                throw new Error(`Template "${templateType}" not found`);
              }
              
              // Set as selected template
              window._selectedAsciiTemplate = asciiBody;
              
              // Replace template variables with form values
              let output = window._selectedAsciiTemplate;
              
              // Replace all template variables with form values
              output = output.replace(/{{(.*?)}}/g, (match, fieldId) => {
                // Handle special cases for fields that need toggle checking
                if (fieldId.endsWith('-with-toggle')) {
                  const realFieldId = fieldId.replace('-with-toggle', '');
                  const field = document.getElementById(realFieldId);
                  
                  // Extract section name (e.g., education-hs, education-college)
                  const sectionPrefix = realFieldId.split('-').slice(0, -1).join('-');
                  const toggleId = `${sectionPrefix}-toggle`;
                  const toggleCheckbox = document.getElementById(toggleId);
                  
                  // Only include if toggle checkbox is checked
                  if (field && toggleCheckbox && toggleCheckbox.checked) {
                    return field.value || "";
                  } else {
                    return "";
                  }
                }
                
                // Normal field processing
                const field = document.getElementById(fieldId);
                
                // Check if the corresponding toggle checkbox exists and is checked
                const toggleId = `${fieldId}-toggle`;
                const toggleCheckbox = document.getElementById(toggleId);
                
                // Only include the field if:
                // 1. There is no toggle checkbox for this field, OR
                // 2. The toggle checkbox exists and is checked
                if (field && (!toggleCheckbox || toggleCheckbox.checked)) {
                  return field.value || "";
                } else {
                  return "";
                }
              });
              
              // Remove lines that are empty or only contain whitespace and special characters
              // This will be a multi-step process to handle various formats
              
              // Step 1: Remove lines with just a label and no content
              output = output.replace(/.*➤.*: (?:\s*|""\s*)$/gm, '');
              output = output.replace(/.*➣.*: (?:\s*|""\s*)$/gm, '');
              output = output.replace(/.*\[.*\].*: (?:\s*|""\s*)$/gm, '');
              
              // Step 2: Remove lines with empty values in the form NAME: VALUE when VALUE is empty
              output = output.replace(/^\s*[^:]+:\s*$/gm, '');
              
              // Step 3: Remove lines with specific patterns like empty High school/College lines
              output = output.replace(/➤ High school:\s*\(Class of\s*\)\s*$/gm, '');
              output = output.replace(/➤ College:\s*at\s*$/gm, '');
              
              // Step 4: Remove multiple consecutive blank lines to clean up the output
              output = output.replace(/\n\s*\n\s*\n+/g, '\n\n');
              
              // Display output
              const outputEl = document.getElementById('output-format');
              if (outputEl) {
                outputEl.textContent = output;
                outputEl.style.display = 'block';
                
                // Scroll to output area
                const outputArea = document.querySelector('.output-area');
                if (outputArea) {
                  outputArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                
                // Show success message
                fixedShowToast('Success', 'Oswald Main format generated successfully!', 'success');
              } else {
                throw new Error('Output element not found');
              }
            } catch(error) {
              console.error('Generation error:', error);
              fixedShowToast('Error', `Failed to generate format: ${error.message}`, 'error');
            }
            
            // Reset button state
            this.innerHTML = '<i class="fas fa-code"></i> Generate Format';
            this.disabled = false;
          }, 500);
        });
      } else {
        console.error('Generate button not found');
      }
      
      // TEMPLATE BUTTON - REMOVED
      // Template button has been removed from the UI
                // Process template placeholders
                let output = window._selectedAsciiTemplate;
                output = output.replace(/{{(.*?)}}/g, (match, fieldId) => {
                  const field = document.getElementById(fieldId.trim());
                  return field ? (field.value || '') : '';
                });
                
      // Template button functionality has been completely removed
      
      // COPY BUTTON - FIXED IMPLEMENTATION
      const copyBtn = document.getElementById('copy-btn');
      if (copyBtn) {
        // Remove any existing event listeners by cloning and replacing
        const newCopyBtn = copyBtn.cloneNode(true);
        copyBtn.parentNode.replaceChild(newCopyBtn, copyBtn);
        
        newCopyBtn.addEventListener('click', function() {
          const outputText = document.getElementById('output-format').textContent;
          if (!outputText.trim()) {
            fixedShowToast('Warning', 'No content to copy', 'warning');
            return;
          }
          
          try {
            navigator.clipboard.writeText(outputText)
              .then(() => fixedShowToast('Copied!', 'Output copied to clipboard', 'success'))
              .catch((err) => {
                console.error('Copy failed:', err);
                fixedShowToast('Error', 'Failed to copy output', 'error');
              });
          } catch(error) {
            console.error('Copy error:', error);
            fixedShowToast('Error', 'Failed to copy output', 'error');
          }
        });
      }
      
      console.log('All buttons have been fixed and reinstalled');
    });
  </script>

  <script>
    // Add event listener to the bottom check all button
    document.getElementById('bottom-check-all-btn').addEventListener('click', function() {
      console.log("Bottom 'Check All Boxes' button clicked");
      
      try {
        // Check all checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
          try {
            checkbox.checked = true;
            
            // Enable associated input if it's a toggle checkbox
            if (checkbox.id && checkbox.id.endsWith('-toggle')) {
              const fieldId = checkbox.id.replace(/-toggle$/, '');
              const field = document.getElementById(fieldId);
              if (field) {
                field.disabled = false;
              }
            }
          } catch (err) {
            console.error('Error checking checkbox:', err);
          }
        });
        
        // Expand all sections
        document.querySelectorAll('.section').forEach(section => {
          section.classList.add('active');
          const content = section.querySelector('.section-content');
          if (content) {
            content.style.display = 'block';
            content.style.height = 'auto';
            content.style.maxHeight = 'none';
            content.style.opacity = '1';
            content.style.padding = '18px 20px';
            content.style.overflow = 'visible';
          }
        });
        
        // FIX: Re-establish section toggle functionality
        document.querySelectorAll('.section-header').forEach(header => {
          // Clone the header to remove existing event listeners
          const newHeader = header.cloneNode(true);
          if (header.parentNode) {
            header.parentNode.replaceChild(newHeader, header);
            
            // Add back the click handler
            newHeader.onclick = function() {
              const section = this.parentNode;
              section.classList.toggle('active');
              
              const content = section.querySelector('.section-content');
              if (!content) return;
              
              if (section.classList.contains('active')) {
                content.style.display = 'block';
                content.style.height = 'auto';
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '18px 20px';
                content.style.overflow = 'visible';
              } else {
                content.style.display = 'none';
                content.style.maxHeight = '0';
                content.style.height = '0';
                content.style.opacity = '0';
                content.style.padding = '0';
              }
            };
          }
        });
        
        // Show success message
        if (typeof fixedShowToast === 'function') {
          fixedShowToast('Success', 'All checkboxes checked and sections expanded', 'success');
        } else {
          alert('All checkboxes checked and sections expanded!');
        }
      } catch (err) {
        console.error('Error in bottom-check-all button click handler:', err);
      }
    });
    
    // Add event listener to the fill test button
    document.getElementById('fill-test-btn').addEventListener('click', function() {
      // Keep track of how many fields were filled
      let filledCount = 0;
      
      // First make sure all checkboxes are checked and sections are expanded
      document.getElementById('bottom-check-all-btn').click();
      
      // Fill all text inputs with "test"
      document.querySelectorAll('input[type="text"], textarea').forEach(input => {
        // Skip disabled inputs
        if (!input.disabled) {
          input.value = 'test';
          filledCount++;
        }
      });
      
      // Show success message
      if (typeof fixedShowToast === 'function') {
        fixedShowToast('Success', `Filled ${filledCount} fields with "test"`, 'success');
      } else {
        alert(`Filled ${filledCount} fields with "test" for testing purposes!`);
      }
    });
    
    // Simple button functions that work across all browsers
    function clearAllFields() {
      if (confirm('Are you sure you want to clear all fields?')) {
        // Clear all text inputs
        var inputs = document.getElementsByTagName('input');
        for (var i = 0; i < inputs.length; i++) {
          if (inputs[i].type === 'text') {
            inputs[i].value = '';
          } else if (inputs[i].type === 'checkbox') {
            // For checkboxes, special handling
            if (inputs[i].id.endsWith('-toggle')) {
              // Keep toggle checkboxes checked
              inputs[i].checked = true;
            } else {
              // Clear other checkboxes
              inputs[i].checked = false;
            }
          }
        }
        
        // Clear all textareas
        var textareas = document.getElementsByTagName('textarea');
        for (var j = 0; j < textareas.length; j++) {
          textareas[j].value = '';
        }
        
        // Clear the output
        document.getElementById('output-format').textContent = '';
        
        // Show message
        alert('All fields have been cleared!');
      }
    }
    
    function clearOutputOnly() {
      document.getElementById('output-format').textContent = '';
      alert('Output cleared!');
    }
    
    function copyOutputToClipboard() {
      var outputElement = document.getElementById('output-format');
      var outputText = outputElement.textContent || outputElement.innerText;
      
      if (!outputText || outputText.trim() === '') {
        alert('No content to copy!');
        return;
      }
      
      // Create temporary textarea
      var tempTextarea = document.createElement('textarea');
      tempTextarea.value = outputText;
      document.body.appendChild(tempTextarea);
      
      // Select and copy
      tempTextarea.select();
      
      try {
        var successful = document.execCommand('copy');
        if (successful) {
          alert('Content copied to clipboard!');
        } else {
          alert('Unable to copy. Please press Ctrl+C to copy the content.');
        }
      } catch (err) {
        alert('Error copying text: ' + err);
      }
      
      // Clean up
      document.body.removeChild(tempTextarea);
    }
    
    function downloadOutputTxt() {
      var outputElement = document.getElementById('output-format');
      var outputText = outputElement.textContent || outputElement.innerText;
      
      if (!outputText || outputText.trim() === '') {
        alert('No content to download!');
        return;
      }
      
      // Get name for filename if available
      var nameField = document.getElementById('basic-name');
      var fileName = (nameField && nameField.value) ? nameField.value.replace(/[^a-z0-9]/gi, '_') + '_dox.txt' : 'dox.txt';
      
      // Create blob and download
      var blob = new Blob([outputText], {type: 'text/plain'});
      
      if (window.navigator && window.navigator.msSaveOrOpenBlob) {
        // For IE
        window.navigator.msSaveOrOpenBlob(blob, fileName);
      } else {
        // For other browsers
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        setTimeout(function() {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 0);
      }
      
      alert('File downloaded as: ' + fileName);
    }
  </script>
</body>
</html>